<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Texan Lee Donuts</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script> --> <!-- 지도 API 스크립트 제거 -->
    <style>
              body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #fff;
            color: #1d1d1f;
            line-height: 1.5;
            overflow-x: hidden;
            width: 100%;
        }

        /* 모달 열렸을 때 body 스크롤 방지 */
        body.modal-open {
            overflow: hidden;
        }

        /* 네비게이션 바 */
        .nav-bar {
            display: flex;
            justify-content: space-between; /* 로고/링크와 계정 분리 */
            align-items: center;
            padding: 0.8rem 2rem; /* 상하 여백 축소, 좌우 유지 */
            background: rgba(255, 255, 255, 0.7); /* 반투명 흰색 배경 */
            backdrop-filter: blur(10px); /* 블러 효과 */
            position: fixed; /* 상단 고정 */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 900;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* 약간의 그림자 */
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
            padding: 0.8rem 1.5rem;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1d1d1f;
            text-decoration: none;
            transition: opacity 0.2s ease;
            display: inline-block; /* Ensure link wraps image */
            vertical-align: middle; /* Align vertically */
        }

        .nav-logo img {
            max-height: 65px; /* Increased height */
            display: block; /* Remove extra space below image */
        }

        .nav-logo:hover {
            opacity: 0.8;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            margin: 0 auto; /* Center links between logo and account */
        }

        .nav-link {
            color: #1d1d1f;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .nav-link:hover {
            color: #0071e3;
        }

        .nav-account {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* 계정 섹션 내부 간격 축소 */
        }

        .login-btn {
            background: none;
            border: none;
            color: #1d1d1f;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s ease;
            display: none; /* Hide the login button */
        }

        .login-btn:hover {
            color: #0071e3;
        }

        /* Style for disabled login button */
        .login-btn:disabled,
        .login-btn[disabled]{
            color: #aaaaaa; /* Grey out text */
            cursor: default; /* Default cursor */
            opacity: 0.6; /* Make it slightly transparent */
        }
        .login-btn:disabled:hover {
             color: #aaaaaa; /* Prevent hover color change */
        }

        /* ORDER ONLINE 버튼 스타일 */
        .order-online-btn {
            /* background-color: #0071e3; */
            background-color: #1d1d1f; /* 진한 회색 배경 */
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-left: 0.5rem; 
            box-shadow: none; /* 그림자 제거 */
        }

        .order-online-btn:hover {
            /* background-color: #0077ED; */
            background-color: #333; /* 호버 시 약간 밝은 회색 */
            transform: translateY(0); /* 호버 시 이동 효과 제거 */
            /* box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); */
        }

        /* 헤더 스타일 - Apple 스타일 */
        .header {
            background: #fbfbfd;
            padding: 8rem 0 4rem;
            text-align: center;
            position: relative;
        }

        .header-content {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 600;
            letter-spacing: -0.015em;
            margin-bottom: 0.5rem;
            color: #1d1d1f;
            position: relative;
            display: inline-block;
        }

        .header p {
            font-size: 1.5rem;
            color: #86868b;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto 1.5rem;
            letter-spacing: -0.01em;
        }

        .header-cta {
            display: inline-block;
            background: #0071e3;
            color: white;
            padding: 0.8rem 2rem;
            border-radius: 30px;
            font-weight: 500;
            font-size: 1rem;
            text-decoration: none;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .header-cta:hover {
            background: #0077ED;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-divider {
            display: none;
        }

        /* 슬라이더 배너 */
        .slider-container {
            position: relative;
            margin: 0 auto;
            overflow: hidden;
            max-width: 1200px;
            margin-bottom: 3rem;
        }

        .slider {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }

        .slide {
            min-width: 100%;
            position: relative;
        }

        .slide img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 12px;
        }

        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2rem;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            color: white;
            border-radius: 0 0 12px 12px;
        }

        .slide-content h3 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .slide-content p {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .slide-btn {
            background: white;
            color: #1d1d1f;
            border: none;
            padding: 0.5rem 1.2rem;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .slide-btn:hover {
            background: #f5f5f7;
            transform: translateY(-2px);
        }

        .slider-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            z-index: 10;
        }

        .slider-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-dot.active {
            background: white;
            transform: scale(1.2);
        }

        .slider-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .slider-arrow:hover {
            background: white;
            transform: translateY(-50%) scale(1.1);
        }

        .slider-prev {
            left: 20px;
        }

        .slider-next {
            right: 20px;
        }

        /* 회사 소개 섹션 */
        .about-section {
            background-color: #fff;
            padding: 4rem 0;
            text-align: center;
        }

        .about-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .about-content h2 {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1d1d1f;
        }

        .about-content p {
            font-size: 1.1rem;
            color: #86868b;
            line-height: 1.7;
            margin-bottom: 2rem;
        }

        .about-features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2rem;
            margin-top: 3rem;
        }

        .feature {
            flex-basis: calc(33.333% - 2rem);
            min-width: 250px;
            text-align: center;
        }

        .feature-icon {
            font-size: 3rem;
            color: #0071e3;
            margin-bottom: 1rem;
        }

        .feature h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: #1d1d1f;
        }

        .feature p {
            font-size: 0.95rem;
            color: #86868b;
            line-height: 1.6;
        }

        /* 메인 컨테이너 스타일 - Apple 스타일 */
        .container {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 2rem 6rem;
            position: relative;
        }

        /* 카테고리 탭 스타일 - Apple 스타일 */
        .category-tabs {
            display: flex;
            justify-content: center;
            margin: 3rem auto 2.5rem;
            max-width: 800px;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            position: sticky;
            top: 70px; /* 네비게이션 바 아래에 위치 */
            z-index: 10;
            backdrop-filter: saturate(180%) blur(20px);
            background-color: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid #f2f2f2;
            padding: 1rem 0;
        }

        .category-tab {
            background: none;
            border: none;
            padding: 0.8rem 1.5rem;
            margin: 0 0.8rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #1d1d1f;
            position: relative;
            font-weight: 500;
            border-radius: 18px;
            letter-spacing: -0.01em;
        }

        .category-tab.active {
            color: #fff;
            background: #1d1d1f;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .category-tab:not(.active):hover {
            background-color: #f5f5f7;
            color: #1d1d1f;
        }

        /* 섹션 타이틀 스타일 - Apple 스타일 */
        .section-title {
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
        }

        .section-title h2 {
            font-size: 2.5rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 1rem;
            letter-spacing: -0.015em;
        }

        .section-title p {
            font-size: 1.2rem;
            color: #86868b;
            max-width: 600px;
            margin: 0 auto;
            letter-spacing: -0.01em;
        }

        /* 카테고리 콘텐츠 스타일 */
        .category-content {
            display: none !important;
        }

        .category-content.active {
            display: grid !important;
        }

        /* 메뉴 그리드 - Apple 스타일 */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); /* 최소 너비 줄임 */
            gap: 2rem; /* 간격 줄임 */
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* 메뉴 아이템 카드 디자인 - 크기 축소 */
        .menu-item {
            display: flex; /* Changed to flex */
            flex-direction: row; /* Set to horizontal */
            align-items: stretch; /* Make image and details same height */
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 12px; /* Adjusted border radius slightly */
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            box-shadow: 0 3px 10px rgba(0,0,0,0.07); /* Adjusted shadow */
            margin-bottom: 1.5rem; /* Add some space between items */
        }

        .menu-item:hover {
            transform: translateY(-4px); /* Slightly more lift on hover */
            box-shadow: 0 8px 18px rgba(0,0,0,0.12); /* Stronger shadow on hover */
        }

        .menu-item img {
            width: 160px; /* Fixed width for image */
            height: 100%; /* Fill height of the card */
            object-fit: cover;
            border-radius: 0; /* Remove individual radius */
            box-shadow: none;
            transition: none; /* Remove transition */
            background-color: #f5f5f5;
            flex-shrink: 0; /* Prevent image shrinking */
        }

        /* 이미지 로드 실패 시 스타일 */
        .menu-item img.error {
            background-size: 50px 50px;
            background-repeat: no-repeat;
            background-position: center;
        }

        .menu-item:hover img {
            transform: none; /* Remove hover effect */
            opacity: 1;
        }

        /* New class for text details */
        .menu-item-details {
            flex: 1; /* Take remaining space */
            padding: 1rem 1.2rem; /* Adjust padding */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center content vertically */
        }

        /* Apply styles previously on menu-item-content to menu-item-details */
        .menu-item-details h3 {
            font-size: 1.0rem; /* Adjusted size */
            font-weight: 600; /* Adjusted weight */
            margin-bottom: 0.4rem;
            color: #1d1d1f;
            letter-spacing: -0.01em;
        }

        .menu-item-details p {
            color: #6e6e73;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            line-height: 1.4; /* Adjusted line height */
            flex-grow: 1; /* Allow description to push price down */
        }

        .menu-item-details .price-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto; /* Pushes to bottom */
            padding-top: 0.5rem; /* Reduced padding */
            border-top: none; /* Removed border */
        }

        .menu-item-details .price {
            font-size: 1.1rem; /* Adjusted size */
            font-weight: 600; /* Adjusted weight */
            color: #1d1d1f;
            padding: 0;
        }

        /* 'Add to Cart' 버튼 스타일 */
        .menu-item-details .add-to-cart {
            display: none !important; /* Hide button to match the target image, ensure it stays hidden */
        }

        .menu-item-details .price-container::before {
            display: none;
        }

        .menu-item .price-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto; /* 항상 하단에 위치하도록 */
            padding-top: 0.6rem; /* 위쪽 여백 줄임 */
            border-top: none; /* 상단 테두리 제거 */
        }

        .menu-item .price {
            font-size: 1.2rem; /* 가격 폰트 크기 줄임 */
            font-weight: 600;
            color: #1d1d1f;
            padding: 0;
        }

        /* 'Add to Cart' 버튼 스타일 - 크기 축소 */
        .menu-item .add-to-cart {
            background: #f5f5f7; /* 밝은 회색 배경 */
            color: #1d1d1f; /* 진한 회색 텍스트 */
            border: none;
            padding: 0.4rem 0.8rem; /* 패딩 줄임 */
            border-radius: 18px; /* 둥근 정도 조정 */
            cursor: pointer;
            font-size: 0.8rem; /* 폰트 크기 줄임 */
            transition: all 0.2s ease;
            font-weight: 500;
            box-shadow: none;
        }

        .menu-item .add-to-cart:hover {
            background: #1d1d1f; /* 호버 시 검정색 배경 */
            color: white; /* 호버 시 흰색 텍스트 유지 */
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .menu-item .price-container::before {
            display: none;
        }

        .menu-item .price {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1d1d1f;
            padding: 0;
            position: relative;
        }

        .details-btn {
            color: #0071e3;
            background: none;
            border: none;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0;
            margin-top: 0.7rem;
            text-decoration: underline;
        }

        /* 메뉴 상세 모달 */
        .menu-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .menu-detail-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .menu-detail-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
            animation: slideUp 0.4s ease;
        }

        .menu-detail-header {
            display: flex;
            gap: 1.5rem;
            padding: 2rem;
        }

        .menu-detail-img {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
        }

        .menu-detail-info {
            flex: 1;
        }

        .menu-detail-info h3 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: #1d1d1f;
        }

        .menu-detail-info p {
            color: #86868b;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .menu-detail-price {
            font-size: 1.6rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 1.5rem;
        }

        .menu-detail-body {
            padding: 0 2rem 2rem;
        }

        .nutrition-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
        }

        .nutrition-table th {
            text-align: left;
            padding: 0.8rem 1rem;
            background-color: #f5f5f7;
            font-weight: 500;
            color: #1d1d1f;
            font-size: 0.9rem;
        }

        .nutrition-table td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid #f5f5f7;
            color: #86868b;
            font-size: 0.9rem;
        }

        .ingredients-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1d1d1f;
        }

        .ingredients-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .ingredient-item {
            background-color: #f5f5f7;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #86868b;
        }

        .menu-detail-footer {
            padding: 1.5rem 2rem;
            background-color: #f5f5f7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-detail-total {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1d1d1f;
        }

        .add-to-cart {
            background: #0071e3;
            color: white;
            border: none;
            padding: 0.7rem 1.6rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            font-weight: 500;
            box-shadow: none;
        }

        .add-to-cart::before {
            display: none;
        }

        .add-to-cart:hover {
            background: #0077ED;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .veg-indicator {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 1px solid #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .veg-indicator::after {
            content: '';
            width: 12px;
            height: 12px;
            background-color: #4CAF50;
            border-radius: 50%;
        }

        /* 장바구니 아이콘 - Apple 스타일 */
        .cart-icon {
            background: #1d1d1f;
            color: #fff;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            margin-left: 10px;
        }

        .cart-icon:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #0071e3;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            border: 1.5px solid #fff;
        }

        /* 장바구니 모달 - Apple 스타일 */
        .cart-modal {
            /* display: none; 제거 */
            display: flex; /* 항상 flex로 설정 */
            position: fixed;
            top: 0;
            left: 0;
            right: 0; 
            bottom: 0; 
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: flex-end; /* 오른쪽 정렬 */
            overflow: hidden; 
            /* 초기 상태: 숨김 */
            visibility: hidden;
            opacity: 0;
            pointer-events: none; /* 숨겨졌을 때 클릭 방지 */
            /* 컨테이너 배경 fade 효과 */
            transition: visibility 0s linear 0.6s, opacity 0.6s ease; /* opacity 시간 일치, 숨길 때 지연 */
        }

        .cart-modal.show,
        .order-modal.show {
            /* display: flex; 이미 설정됨 */
            /* 상태 변경: 보임 */
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
            /* 컨테이너 배경 fade-in 즉시 시작 */
            transition: visibility 0s linear 0s, opacity 0.6s ease;
        }

        /* 슬라이드 인/아웃 애니메이션 (참고용, 현재는 transition 사용) */
        @keyframes slideInFromRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        @keyframes slideOutToRight {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }

        /* 모달 콘텐츠 공통 스타일 (슬라이드 적용) */
        .cart-content,
        .order-content {
            background: #fff;
            padding: 0;
            border-radius: 12px 0 0 12px; 
            width: 480px; 
            max-width: 90%;
            height: 100%; 
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.15); 
            /* 초기 상태: 오른쪽 밖 */
            transform: translateX(100%); 
            /* opacity: 0; 제거 -> 컨테이너 opacity로 제어 */
            /* 콘텐츠 슬라이드 애니메이션 */
            transition: transform 0.3s ease; /* 슬라이드 속도 0.3초로 변경 */
        }

        /* 특정 모달 너비 조정 */
        #checkoutModal .order-content {
            width: 550px; 
        }
        /* Payment 모달도 슬라이드되도록 너비 지정 */
        #orderModal .order-content {
             width: 500px; /* Payment 모달 너비 조정 */
        }

        /* 슬라이드되지 않는 모달들 */
        #orderChoiceModal .order-content,
        #pickupTimeModal .order-content,
        #loginModal .order-content,
        #registerModal .order-content,
        #accountModal .order-content,
        #menuDetailModal .menu-detail-content {
             width: 450px; /* 작은 모달들 너비 */
             height: auto; /* 높이는 자동으로 */
             max-height: 90vh; /* 너무 길어지지 않도록 */
             border-radius: 12px; /* 일반 모달은 모든 모서리 둥글게 */
             /* 슬라이드 관련 스타일 리셋 */
             transform: none; 
             transition: none; /* 트랜지션 제거 */
             /* 중앙 정렬을 위해 컨테이너 스타일 재정의 */
             /* 부모(.order-modal)에 justify-content: center; align-items: center; 필요 */
             /* -> 이 방식 대신, show 할 때 컨테이너에 클래스 추가해서 제어하는 것이 나을 수 있음 */
             /* -> 또는, 각 모달 컨테이너 자체에 다른 클래스를 부여 */
              /* 임시: 기존 fadeIn/slideUp 애니메이션 유지 */
              opacity: 1;
              animation: fadeIn 0.3s ease, slideUp 0.4s ease; 
        }
        /* 계정 모달은 더 넓게 */
        #accountModal .order-content { width: 800px; }
        /* 메뉴 상세 모달도 넓게 */
        #menuDetailModal .menu-detail-content { width: 700px; }

        /* 기존 slideUp/fadeIn 애니메이션 유지 */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
             from { opacity: 0; }
             to { opacity: 1; }
         }


        /* 슬라이드 모달 열릴 때 콘텐츠 위치 변경 */
        .cart-modal.show .cart-content,
        #checkoutModal.show .order-content,
        #orderModal.show .order-content { /* Payment 모달 추가 */
            transform: translateX(0);
            /* opacity: 1; 제거 -> 컨테이너 opacity로 제어 */
        }

        /* 슬라이드 모달 닫힐 때 (참고용) */
        /* JS에서 닫기 전에 .hiding 클래스 추가 후 transitionend 이벤트 기다려서 .show 제거 */
        /*
        .cart-modal.hiding .cart-content,
        #checkoutModal.hiding .order-content,
        #orderModal.hiding .order-content {
            transform: translateX(100%);
        }
        */

        /* 모달 내부 스크롤 영역 처리 (변경 없음) */
        .cart-items, 
        .checkout-body, 
        .order-form, 
        #accountModal > div:last-child, 
        .menu-detail-body
         {
            overflow-y: auto;
            flex-grow: 1; 
            padding: 1.5rem 2rem; 
        }
        .checkout-body { padding: 1.5rem 2rem 2rem; }
        #orderModal .order-form { padding: 1.5rem 2rem 2rem; }


        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #f2f2f2;
            flex-shrink: 0; /* 헤더 크기 고정 */
        }

        .cart-header h2 {
            color: #1d1d1f;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin: 0;
            letter-spacing: -0.01em;
        }

        .cart-header h2 i {
            color: #0071e3;
        }

        .close-cart {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #86868b;
            transition: color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .close-cart:hover {
            color: #1d1d1f;
            background-color: #f5f5f7;
        }

        .cart-items {
            padding: 1.5rem 2rem;
            overflow-y: auto;
            flex: 1;
            max-height: 50vh;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.2rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border-radius: 14px;
            background-color: #f5f5f7;
        }

        .cart-item:hover {
            background-color: #f0f0f2;
            transform: translateX(5px);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 500;
            margin-bottom: 0.3rem;
            color: #1d1d1f;
        }

        .cart-item-price {
            color: #86868b;
            font-size: 0.9rem;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .quantity-btn {
            background: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #1d1d1f;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .quantity-btn:hover {
            background: #0071e3;
            color: white;
        }

        .cart-footer {
            padding: 1.5rem 2rem;
            background-color: #fbfbfd;
            border-top: 1px solid #f2f2f2;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .cart-total-label {
            font-weight: 500;
            color: #1d1d1f;
        }

        .cart-total-amount {
            font-weight: 600;
            color: #1d1d1f;
        }

        /* Checkout 버튼 (장바구니 모달) */
        .checkout-btn {
            /* background: #0071e3; */
            background: #1d1d1f; /* 진한 회색 배경 */
            color: white;
            border: none;
            padding: 1rem 0;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: none;
            letter-spacing: -0.01em;
        }

        .checkout-btn:hover {
            /* background: #0077ED; */
            background: #333; /* 호버 시 약간 밝은 회색 */
            transform: translateY(0); /* 호버 시 이동 효과 제거 */
            /* box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); */
        }

        .empty-cart-message {
            text-align: center;
            padding: 3rem 2rem;
            color: #86868b;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .empty-cart-message .material-icons {
            font-size: 3rem;
            color: #ddd;
        }

        .empty-cart-message p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }

        /* 주문 모달 - Apple 스타일 */
        .order-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .order-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .order-content {
            background: white;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* hidden에서 auto로 변경 */
            animation: slideUp 0.4s ease;
        }

        .order-form {
            padding: 1.5rem 2rem 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            /* overflow-y: auto; 제거 */
            /* max-height: 60vh; 제거 */
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
            font-size: 0.95rem;
            color: #1d1d1f;
            letter-spacing: -0.01em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.9rem 1rem;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 1rem;
            background-color: #fff;
            transition: all 0.3s ease;
            width: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .form-group textarea {
            resize: none;
            line-height: 1.5;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0071e3;
            background-color: white;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        /* 시간 표시용 div 스타일 추가 */
        .form-control-display {
            padding: 0.9rem 1rem;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 1rem;
            background-color: #f5f5f7; /* 약간 다른 배경색으로 비활성 상태 표시 */
            color: #1d1d1f;
            min-height: calc(0.9rem * 2 + 1rem + 2px); /* 다른 input과 높이 맞추기 */
            display: flex;
            align-items: center;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #86868b;
        }

        /* 최종 제출 버튼 (Confirm, Complete, Place Order 등) */
        .submit-order {
            /* background: #0071e3; */
            background: #1d1d1f; /* 진한 회색 배경 */
            color: white;
            border: none;
            padding: 1rem 0;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-weight: 500;
            box-shadow: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            letter-spacing: -0.01em;
        }

        .submit-order:hover {
            /* background: #0077ED; */
            background: #333; /* 호버 시 약간 밝은 회색 */
            transform: translateY(0); /* 호버 시 이동 효과 제거 */
            /* box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); */
        }

        .submit-order .material-icons {
            font-size: 1.3rem;
        }

        /* 로딩 오버레이 - Apple 스타일 */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0071e3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes addToCartSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .add-success {
            animation: addToCartSuccess 0.5s ease;
        }

        /* 메뉴 아이템이 없을 때 스타일 */
        .no-items-message {
            text-align: center;
            padding: 3rem;
            color: #86868b;
            font-size: 1rem;
            background: #fbfbfd;
            border-radius: 18px;
            border: none;
            margin: 2rem auto;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* 모바일 반응형 디자인 - Apple 스타일 */
        @media (max-width: 768px) {
            .header {
                padding: 4rem 0 3rem;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .header p {
                font-size: 1.2rem;
                padding: 0 1rem;
             }

            .container {
                padding: 0 1.5rem 3rem;
            }
            
             .section-title h2 {
                font-size: 2rem;
            }
            
            .section-title p {
                font-size: 1rem;
                padding: 0 1rem;
            }
            
            .category-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 0.8rem 1rem;
                margin: 2rem 0;
            }
            
            .category-tab {
                white-space: nowrap;
                flex-shrink: 0;
                padding: 0.7rem 1.2rem;
                font-size: 0.85rem;
                margin: 0 0.4rem;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .menu-item {
                padding: 1.5rem;
            }
            
            .menu-item-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .menu-item img {
                margin-right: 0;
                margin-bottom: 1.5rem;
            }
            
            .menu-item-content {
                text-align: center;
             }
            
            .menu-item .price-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .cart-content,
            .order-content {
                width: 95%;
              }
        }

        @media (min-width: 769px) and (max-width: 1100px) {
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* 애니메이션 효과 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 주문 모달 & 로그인 모달 공통 스타일 */
        .order-content {
            background: white;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }

        /* 소셜 로그인 버튼 스타일 */
        .social-login-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center; /* 가운데 정렬 */
            width: 100%; /* 부모 요소 너비에 맞춤 */
            max-width: 280px; /* 최대 너비 설정 */
            height: 44px; /* 높이 조절 */
            border-radius: 8px; /* 둥근 모서리 */
            border: 1px solid #dadce0; /* 테두리 */
            background-color: white; /* 기본 배경 흰색 */
            color: #3c4043; /* 기본 글자색 */
            text-decoration: none;
            font-size: 0.9rem; /* 글자 크기 조절 */
            font-weight: 500;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
            padding: 0 15px; /* 내부 여백 */
        }

        .social-login-btn:hover {
            background-color: #f8f9fa; /* 호버 시 배경색 */
            border-color: #c6cacc;
            opacity: 1; /* 호버 시 투명도 제거 */
        }

        .social-login-btn svg {
            /* SVG 아이콘 스타일 (필요시 추가) */
        }

        /* 각 소셜 버튼별 특화 스타일 */
        .social-login-btn.apple-btn {
            background-color: #000;
            color: white;
            border-color: #000;
        }
        .social-login-btn.apple-btn:hover {
            background-color: #333;
            border-color: #333;
        }

        .social-login-btn.facebook-btn {
            background-color: #1877f2; /* Facebook 파란색 */
            color: white;
            border-color: #1877f2;
        }
        .social-login-btn.facebook-btn:hover {
            background-color: #166fe5;
            border-color: #166fe5;
        }

        /* 로그인 모달 크기 조정 */
        #loginModal .order-form {
            padding: 1rem 1.5rem 1.5rem; /* 패딩 축소 */
            gap: 0.8rem; /* 요소 간 간격 축소 */
        }

        #loginModal .form-group {
            gap: 0.3rem; /* 레이블과 인풋 간격 축소 */
        }

        #loginModal .form-group label {
            font-size: 0.85rem; /* 레이블 폰트 크기 축소 */
        }

        #loginModal .form-group input {
            padding: 0.7rem 0.8rem; /* 인풋 패딩 축소 */
            font-size: 0.9rem; /* 인풋 폰트 크기 축소 */
        }

        #loginModal .submit-order {
            padding: 0.7rem 0; /* 버튼 패딩 축소 */
            font-size: 0.9rem; /* 버튼 폰트 크기 축소 */
            margin-top: 0.8rem; /* 버튼 상단 마진 축소 */
        }
        #loginModal .submit-order .material-icons {
            font-size: 1.1rem; /* 버튼 아이콘 크기 축소 */
        }

        #loginModal .social-login-btn {
            height: 38px; /* 소셜 버튼 높이 축소 */
            font-size: 0.85rem; /* 소셜 버튼 폰트 크기 축소 */
            max-width: 250px; /* 소셜 버튼 최대 너비 축소 */
        }
         #loginModal .social-login-btn svg {
            width: 16px; /* 소셜 버튼 아이콘 크기 축소 */
            height: 16px;
            margin-right: 8px;
        }

        #loginModal div[style*="text-align: center"] {
            margin-top: 1rem; /* "Or log in with:" 위 마진 축소 */
            padding-top: 0.8rem; /* 구분선 위 패딩 축소 */
        }
        #loginModal div[style*="text-align: center"] p {
            font-size: 0.8rem; /* "Or...", "Don't have..." 폰트 크기 축소 */
            margin-bottom: 0.8rem; /* "Or log in with:" 아래 마진 축소 */
        }
        #loginModal div[style*="text-align: center"] > div {
             gap: 0.6rem; /* 소셜 버튼 간격 축소 */
        }
        #loginModal form > p[style*="text-align: center"] {
             margin-top: 1rem; /* "Don't have account?" 위 마진 축소 */
        }

        /* 주문 선택 모달 내부 버튼 스타일 */
        .order-choice-btn {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
                 font-size: 1rem;
            font-weight: 500;
            color: #1d1d1f;
            text-align: left;
        }

        .order-choice-btn .material-icons {
            margin-right: 1rem;
            color: #0071e3;
        }

        .order-choice-btn .arrow {
            margin-left: auto;
            color: #86868b;
            transition: transform 0.2s ease;
        }

        .order-choice-btn:hover {
            border-color: #0071e3;
            background-color: #f5faff;
            box-shadow: 0 2px 8px rgba(0, 113, 227, 0.1);
        }

        .order-choice-btn:hover .arrow {
            transform: translateX(3px);
        }

        /* 장바구니 버튼 비활성화/숨김 스타일 */
        .menu-item .add-to-cart {
            display: none; /* 기본적으로 숨김 */
        }
        .cart-footer .checkout-btn {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none; /* 클릭 이벤트 방지 */
        }

        /* PICKUP 활성화 시 장바구니 버튼 활성화/표시 */
        body.pickup-active .menu-item .add-to-cart {
            display: inline-block; /* 활성화 시 표시 (inline-block 또는 block 등 적절히 선택) */
            /* display: flex; */ /* 버튼 내용에 따라 flex도 가능 */
        }
        body.pickup-active .cart-footer .checkout-btn {
            opacity: 1;
            cursor: pointer;
            pointer-events: auto;
        }

        /* 커스텀 시간 선택 드롭다운 스타일 */
        .custom-time-select {
            position: relative;
            width: 100%;
        }

        .time-select-trigger {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.9rem 1rem;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            background-color: #fff;
            cursor: pointer;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            font-size: 1rem;
        }

        .time-select-trigger:hover, .time-select-trigger.open {
            border-color: #0071e3;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        .time-select-trigger span {
            color: #1d1d1f;
        }

        .time-select-trigger .material-icons {
            color: #86868b;
            transition: transform 0.2s ease;
        }

        .time-select-trigger.open .material-icons {
            transform: rotate(180deg);
        }

        .time-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            right: 0;
            background-color: #fff;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001; /* 다른 모달 요소 위에 오도록 */
        }

        .time-dropdown.show {
            display: block;
        }

        .time-option {
            padding: 0.8rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.95rem;
            color: #1d1d1f;
        }

        .time-option:hover {
            background-color: #f5f5f7;
        }

        .time-option.selected {
            background-color: #e8f0fd;
            font-weight: 500;
            color: #0071e3;
        }

        /* 장바구니/주문 관련 모달 공통 스타일 (슬라이드 효과 적용) */
        .cart-modal,
        .order-modal {
            /* display: none; 제거 */
            display: flex; /* 항상 flex로 설정 */
            position: fixed;
            top: 0;
            left: 0;
            right: 0; 
            bottom: 0; 
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: flex-end; /* 오른쪽 정렬 */
            overflow: hidden; 
            /* 초기 상태: 숨김 */
            visibility: hidden;
            opacity: 0;
            pointer-events: none; /* 숨겨졌을 때 클릭 방지 */
            /* 컨테이너 배경 fade 효과 */
            transition: visibility 0s linear 0.6s, opacity 0.6s ease; /* opacity 시간 일치, 숨길 때 지연 */
        }

        .cart-modal.show,
        .order-modal.show {
            /* display: flex; 이미 설정됨 */
            /* 상태 변경: 보임 */
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
            /* 컨테이너 배경 fade-in 즉시 시작 */
            transition: visibility 0s linear 0s, opacity 0.6s ease;
        }

        /* 슬라이드 인/아웃 애니메이션 (참고용, 현재는 transition 사용) */
        @keyframes slideInFromRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        @keyframes slideOutToRight {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }

        /* 모달 콘텐츠 공통 스타일 (슬라이드 적용) */
        .cart-content,
        .order-content {
            background: #fff;
            padding: 0;
            border-radius: 12px 0 0 12px; 
            width: 480px; 
            max-width: 90%;
            height: 100%; 
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.15); 
            /* 초기 상태: 오른쪽 밖 */
            transform: translateX(100%); 
            /* opacity: 0; 제거 -> 컨테이너 opacity로 제어 */
            /* 콘텐츠 슬라이드 애니메이션 */
            transition: transform 0.3s ease; /* 슬라이드 속도 0.3초로 변경 */
        }

        /* 특정 모달 너비 조정 */
        #checkoutModal .order-content {
            width: 550px; 
        }
        /* Payment 모달도 슬라이드되도록 너비 지정 */
        #orderModal .order-content {
             width: 500px; /* Payment 모달 너비 조정 */
        }

        /* 슬라이드되지 않는 모달들 */
        #orderChoiceModal .order-content,
        #pickupTimeModal .order-content,
        #loginModal .order-content,
        #registerModal .order-content,
        #accountModal .order-content,
        #menuDetailModal .menu-detail-content {
             width: 450px; /* 작은 모달들 너비 */
             height: auto; /* 높이는 자동으로 */
             max-height: 90vh; /* 너무 길어지지 않도록 */
             border-radius: 12px; /* 일반 모달은 모든 모서리 둥글게 */
             /* 슬라이드 관련 스타일 리셋 */
             transform: none; 
             transition: none; /* 트랜지션 제거 */
             /* 중앙 정렬을 위해 컨테이너 스타일 재정의 */
             /* 부모(.order-modal)에 justify-content: center; align-items: center; 필요 */
             /* -> 이 방식 대신, show 할 때 컨테이너에 클래스 추가해서 제어하는 것이 나을 수 있음 */
             /* -> 또는, 각 모달 컨테이너 자체에 다른 클래스를 부여 */
              /* 임시: 기존 fadeIn/slideUp 애니메이션 유지 */
              opacity: 1;
              animation: fadeIn 0.3s ease, slideUp 0.4s ease; 
        }
        /* 계정 모달은 더 넓게 */
        #accountModal .order-content { width: 800px; }
        /* 메뉴 상세 모달도 넓게 */
        #menuDetailModal .menu-detail-content { width: 700px; }

        /* 기존 slideUp/fadeIn 애니메이션 유지 */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
             from { opacity: 0; }
             to { opacity: 1; }
         }


        /* 슬라이드 모달 열릴 때 콘텐츠 위치 변경 */
        .cart-modal.show .cart-content,
        #checkoutModal.show .order-content,
        #orderModal.show .order-content { /* Payment 모달 추가 */
            transform: translateX(0);
            /* opacity: 1; 제거 -> 컨테이너 opacity로 제어 */
        }

        /* 슬라이드 모달 닫힐 때 (참고용) */
        /* JS에서 닫기 전에 .hiding 클래스 추가 후 transitionend 이벤트 기다려서 .show 제거 */
        /*
        .cart-modal.hiding .cart-content,
        #checkoutModal.hiding .order-content,
        #orderModal.hiding .order-content {
            transform: translateX(100%);
        }
        */

        /* 모달 내부 스크롤 영역 처리 (변경 없음) */
        .cart-items, 
        .checkout-body, 
        .order-form, 
        #accountModal > div:last-child, 
        .menu-detail-body
         {
            overflow-y: auto;
            flex-grow: 1; 
            padding: 1.5rem 2rem; 
        }
        .checkout-body { padding: 1.5rem 2rem 2rem; }
        #orderModal .order-form { padding: 1.5rem 2rem 2rem; }


        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #f2f2f2;
            flex-shrink: 0; /* 헤더 크기 고정 */
        }

        .cart-header h2 {
            color: #1d1d1f;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin: 0;
            letter-spacing: -0.01em;
        }

        .cart-header h2 i {
            color: #0071e3;
        }

        .close-cart {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #86868b;
            transition: color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .close-cart:hover {
            color: #1d1d1f;
            background-color: #f5f5f7;
        }

        .cart-items {
            padding: 1.5rem 2rem;
            overflow-y: auto;
            flex: 1;
            max-height: 50vh;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.2rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border-radius: 14px;
            background-color: #f5f5f7;
        }

        .cart-item:hover {
            background-color: #f0f0f2;
            transform: translateX(5px);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 500;
            margin-bottom: 0.3rem;
            color: #1d1d1f;
        }

        .cart-item-price {
            color: #86868b;
            font-size: 0.9rem;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .quantity-btn {
            background: white;
            border: none;
            border-radius: 50%;
                 width: 28px;
                 height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #1d1d1f;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .quantity-btn:hover {
            background: #0071e3;
            color: white;
        }

        .cart-footer {
            padding: 1.5rem 2rem;
            background-color: #fbfbfd;
            border-top: 1px solid #f2f2f2;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .cart-total-label {
            font-weight: 500;
            color: #1d1d1f;
        }

        .cart-total-amount {
            font-weight: 600;
            color: #1d1d1f;
        }

        /* Checkout 버튼 (장바구니 모달) */
        .checkout-btn {
            /* background: #0071e3; */
            background: #1d1d1f; /* 진한 회색 배경 */
            color: white;
            border: none;
            padding: 1rem 0;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: none;
            letter-spacing: -0.01em;
        }

        .checkout-btn:hover {
            /* background: #0077ED; */
            background: #333; /* 호버 시 약간 밝은 회색 */
            transform: translateY(0); /* 호버 시 이동 효과 제거 */
            /* box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); */
        }

        .empty-cart-message {
            text-align: center;
            padding: 3rem 2rem;
            color: #86868b;
            display: flex;
            flex-direction: column;
            align-items: center;
                 gap: 1rem;
             }

        .empty-cart-message .material-icons {
            font-size: 3rem;
            color: #ddd;
        }

        .empty-cart-message p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }

        /* 주문 모달 - Apple 스타일 */
        .order-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .order-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .order-content {
            background: white;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* hidden에서 auto로 변경 */
            animation: slideUp 0.4s ease;
        }

        .order-form {
            padding: 1.5rem 2rem 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            /* overflow-y: auto; 제거 */
            /* max-height: 60vh; 제거 */
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
            font-size: 0.95rem;
            color: #1d1d1f;
            letter-spacing: -0.01em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.9rem 1rem;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
                 font-size: 1rem;
            background-color: #fff;
            transition: all 0.3s ease;
            width: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .form-group textarea {
            resize: none;
                 line-height: 1.5;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0071e3;
            background-color: white;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        /* 시간 표시용 div 스타일 추가 */
        .form-control-display {
            padding: 0.9rem 1rem;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 1rem;
            background-color: #f5f5f7; /* 약간 다른 배경색으로 비활성 상태 표시 */
            color: #1d1d1f;
            min-height: calc(0.9rem * 2 + 1rem + 2px); /* 다른 input과 높이 맞추기 */
            display: flex;
            align-items: center;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #86868b;
        }

        /* 최종 제출 버튼 (Confirm, Complete, Place Order 등) */
        .submit-order {
            /* background: #0071e3; */
            background: #1d1d1f; /* 진한 회색 배경 */
            color: white;
            border: none;
            padding: 1rem 0;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-weight: 500;
            box-shadow: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            letter-spacing: -0.01em;
        }

        .submit-order:hover {
            /* background: #0077ED; */
            background: #333; /* 호버 시 약간 밝은 회색 */
            transform: translateY(0); /* 호버 시 이동 효과 제거 */
            /* box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); */
        }

        .submit-order .material-icons {
            font-size: 1.3rem;
        }

        /* 로딩 오버레이 - Apple 스타일 */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0071e3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes addToCartSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .add-success {
            animation: addToCartSuccess 0.5s ease;
        }

        /* 메뉴 아이템이 없을 때 스타일 */
        .no-items-message {
            text-align: center;
            padding: 3rem;
            color: #86868b;
            font-size: 1rem;
            background: #fbfbfd;
            border-radius: 18px;
            border: none;
            margin: 2rem auto;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* 모바일 반응형 디자인 - Apple 스타일 */
        @media (max-width: 768px) {
            .header {
                padding: 4rem 0 3rem;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .header p {
                font-size: 1.2rem;
                padding: 0 1rem;
             }

            .container {
                padding: 0 1.5rem 3rem;
            }
            
             .section-title h2 {
                font-size: 2rem;
            }
            
            .section-title p {
                font-size: 1rem;
                padding: 0 1rem;
            }
            
            .category-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 0.8rem 1rem;
                margin: 2rem 0;
            }
            
            .category-tab {
                white-space: nowrap;
                flex-shrink: 0;
                padding: 0.7rem 1.2rem;
                font-size: 0.85rem;
                margin: 0 0.4rem;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .menu-item {
                padding: 1.5rem;
            }
            
            .menu-item-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .menu-item img {
                margin-right: 0;
                margin-bottom: 1.5rem;
            }
            
            .menu-item-content {
                text-align: center;
             }
            
            .menu-item .price-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .cart-content,
            .order-content {
                width: 95%;
              }
        }

        @media (min-width: 769px) and (max-width: 1100px) {
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* 애니메이션 효과 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 주문 모달 & 로그인 모달 공통 스타일 */
        .order-content {
            background: white;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }

        /* 소셜 로그인 버튼 스타일 */
        .social-login-btn {
            display: inline-flex;
                align-items: center;
            justify-content: center; /* 가운데 정렬 */
            width: 100%; /* 부모 요소 너비에 맞춤 */
            max-width: 280px; /* 최대 너비 설정 */
            height: 44px; /* 높이 조절 */
            border-radius: 8px; /* 둥근 모서리 */
            border: 1px solid #dadce0; /* 테두리 */
            background-color: white; /* 기본 배경 흰색 */
            color: #3c4043; /* 기본 글자색 */
            text-decoration: none;
            font-size: 0.9rem; /* 글자 크기 조절 */
            font-weight: 500;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
            padding: 0 15px; /* 내부 여백 */
        }

        .social-login-btn:hover {
            background-color: #f8f9fa; /* 호버 시 배경색 */
            border-color: #c6cacc;
            opacity: 1; /* 호버 시 투명도 제거 */
        }

        .social-login-btn svg {
            /* SVG 아이콘 스타일 (필요시 추가) */
        }

        /* 각 소셜 버튼별 특화 스타일 */
        .social-login-btn.apple-btn {
            background-color: #000;
            color: white;
            border-color: #000;
        }
        .social-login-btn.apple-btn:hover {
            background-color: #333;
            border-color: #333;
        }

        .social-login-btn.facebook-btn {
            background-color: #1877f2; /* Facebook 파란색 */
            color: white;
            border-color: #1877f2;
        }
        .social-login-btn.facebook-btn:hover {
            background-color: #166fe5;
            border-color: #166fe5;
        }

        /* 로그인 모달 크기 조정 */
        #loginModal .order-form {
            padding: 1rem 1.5rem 1.5rem; /* 패딩 축소 */
            gap: 0.8rem; /* 요소 간 간격 축소 */
        }

        #loginModal .form-group {
            gap: 0.3rem; /* 레이블과 인풋 간격 축소 */
        }

        #loginModal .form-group label {
            font-size: 0.85rem; /* 레이블 폰트 크기 축소 */
        }

        #loginModal .form-group input {
            padding: 0.7rem 0.8rem; /* 인풋 패딩 축소 */
            font-size: 0.9rem; /* 인풋 폰트 크기 축소 */
        }

        #loginModal .submit-order {
            padding: 0.7rem 0; /* 버튼 패딩 축소 */
            font-size: 0.9rem; /* 버튼 폰트 크기 축소 */
            margin-top: 0.8rem; /* 버튼 상단 마진 축소 */
        }
        #loginModal .submit-order .material-icons {
            font-size: 1.1rem; /* 버튼 아이콘 크기 축소 */
        }

        #loginModal .social-login-btn {
            height: 38px; /* 소셜 버튼 높이 축소 */
            font-size: 0.85rem; /* 소셜 버튼 폰트 크기 축소 */
            max-width: 250px; /* 소셜 버튼 최대 너비 축소 */
        }
         #loginModal .social-login-btn svg {
            width: 16px; /* 소셜 버튼 아이콘 크기 축소 */
            height: 16px;
            margin-right: 8px;
        }

        #loginModal div[style*="text-align: center"] {
            margin-top: 1rem; /* "Or log in with:" 위 마진 축소 */
            padding-top: 0.8rem; /* 구분선 위 패딩 축소 */
        }
        #loginModal div[style*="text-align: center"] p {
            font-size: 0.8rem; /* "Or...", "Don't have..." 폰트 크기 축소 */
            margin-bottom: 0.8rem; /* "Or log in with:" 아래 마진 축소 */
        }
        #loginModal div[style*="text-align: center"] > div {
             gap: 0.6rem; /* 소셜 버튼 간격 축소 */
        }
        #loginModal form > p[style*="text-align: center"] {
             margin-top: 1rem; /* "Don't have account?" 위 마진 축소 */
        }

        /* 주문 선택 모달 내부 버튼 스타일 */
        .order-choice-btn {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            font-weight: 500;
            color: #1d1d1f;
            text-align: left;
        }

        .order-choice-btn .material-icons {
            margin-right: 1rem;
            color: #0071e3;
        }

        .order-choice-btn .arrow {
            margin-left: auto;
            color: #86868b;
            transition: transform 0.2s ease;
        }

        .order-choice-btn:hover {
            border-color: #0071e3;
            background-color: #f5faff;
            box-shadow: 0 2px 8px rgba(0, 113, 227, 0.1);
        }

        .order-choice-btn:hover .arrow {
            transform: translateX(3px);
        }

        /* 장바구니 버튼 비활성화/숨김 스타일 */
             .menu-item .add-to-cart {
            display: none; /* 기본적으로 숨김 */
        }
        .cart-footer .checkout-btn {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none; /* 클릭 이벤트 방지 */
        }

        /* PICKUP 활성화 시 장바구니 버튼 활성화/표시 */
        body.pickup-active .menu-item .add-to-cart {
            display: inline-block; /* 활성화 시 표시 (inline-block 또는 block 등 적절히 선택) */
            /* display: flex; */ /* 버튼 내용에 따라 flex도 가능 */
        }
        body.pickup-active .cart-footer .checkout-btn {
            opacity: 1;
            cursor: pointer;
            pointer-events: auto;
        }

        /* 커스텀 시간 선택 드롭다운 스타일 */
        .custom-time-select {
            position: relative;
            width: 100%;
        }

        .time-select-trigger {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.9rem 1rem;
            border: 1px solid #d2d2d7;
                 border-radius: 12px;
            background-color: #fff;
            cursor: pointer;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            font-size: 1rem;
        }

        .time-select-trigger:hover, .time-select-trigger.open {
            border-color: #0071e3;
            box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.2);
        }

        .time-select-trigger span {
            color: #1d1d1f;
        }

        .time-select-trigger .material-icons {
            color: #86868b;
            transition: transform 0.2s ease;
        }

        .time-select-trigger.open .material-icons {
            transform: rotate(180deg);
        }

        .time-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            right: 0;
            background-color: #fff;
            border: 1px solid #d2d2d7;
                 border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001; /* 다른 모달 요소 위에 오도록 */
        }

        .time-dropdown.show {
            display: block;
        }

        .time-option {
                   padding: 0.8rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.95rem;
            color: #1d1d1f;
        }

        .time-option:hover {
            background-color: #f5f5f7;
        }

        .time-option.selected {
            background-color: #e8f0fd;
            font-weight: 500;
            color: #0071e3;
        }

        /* Payment 모달 크기 조정 */
        #orderModal .order-form {
            padding: 1.2rem 2rem 1.5rem; /* 상하 패딩 축소 */
            gap: 1rem; /* 요소 간 간격 축소 */
        }

        #orderModal .form-group {
            gap: 0.4rem; /* 레이블과 인풋 간격 축소 */
        }

        #orderModal .form-group input,
        #orderModal .form-group textarea {
            padding: 0.7rem 1rem; /* 인풋/텍스트 영역 내부 패딩 축소 */
            font-size: 0.95rem; /* 폰트 크기 약간 축소 */
        }

        #orderModal .form-group textarea#notes {
            rows: 2; /* 텍스트 영역 높이 줄임 */
            min-height: 60px; /* 최소 높이 설정 (약 2줄) */
        }

        #orderModal .pricing-summary {
            padding-top: 1rem; /* 가격 요약 위쪽 패딩 축소 */
            margin-top: 0.8rem; /* 가격 요약 위쪽 마진 축소 */
        }

        #orderModal .submit-order {
            padding: 0.8rem 0; /* 버튼 패딩 축소 */
            font-size: 0.95rem; /* 버튼 폰트 크기 축소 */
            margin-top: 1rem; /* 버튼 상단 마진 축소 */
        }

        html, body {
            max-width: 100%;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* 모바일 반응형 디자인 - 추가 최적화 */
        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden; /* Ensure no horizontal scroll */
                -webkit-text-size-adjust: 100%; /* Prevent font scaling on iOS */
            }

            /* Ensure all images are responsive */
            img {
                max-width: 100%;
                height: auto;
            }

            /* 네비게이션 바 조정 */
            .nav-bar {
                padding: 0.8rem 1rem; /* 유지 */
                justify-content: space-between; /* 로고와 계정 영역 분리 */
                align-items: center; /* 수직 중앙 정렬 */
            }
            .nav-logo {
                font-size: 1.1rem; /* 유지 */
                flex-shrink: 0; /* 로고 줄어들지 않게 */
            }
            .nav-links {
                display: none !important; /* 확실히 숨김 처리 */
            }
            .nav-account {
                gap: 0.5rem; /* 계정 영역 내부 간격 축소 */
                flex-shrink: 0; /* 계정 영역 줄어들지 않게 */
            }
            /* TODO: Add hamburger menu button styling and JS */
            .login-btn,
            .order-online-btn {
                font-size: 0.8rem; /* 유지 */
                padding: 0.4rem 0.6rem; /* 버튼 내부 패딩 축소 */
            }
            .cart-icon {
                width: 36px; /* 유지 */
                height: 36px; /* 유지 */
                margin-left: 0; /* 왼쪽 마진 제거 (gap으로 처리) */
            }
            .cart-badge {
                width: 16px; /* 유지 */
                height: 16px;
                font-size: 8px;
            }

            .cart-content,
            .order-content {
                width: 90%;
                max-width: 90%;
                border-radius: 12px !important;
                transform: none !important;
                max-height: 85vh; /* 모달 최대 높이 제한 */
                /* overflow-y: auto; /* 개별 스크롤 영역 대신 전체 모달에 적용 고려 */
            }

            /* 개별 스크롤 영역 패딩 재확인 */
            .cart-items,
            .checkout-body,
            .order-form,
            #accountModal > div:last-child > div, /* Corrected selector for account content */
            .menu-detail-body {
                padding: 1rem 1.2rem;
                overflow-y: auto; /* Ensure individual sections scroll if needed */
                flex-grow: 1; /* Allow content to take available space */
            }

            #accountModal .order-content { width: 95%; } /* 계정 모달 너비 모바일 맞춤 */
            #accountModal > div:last-child {
                flex-direction: column; /* Account modal tabs stack vertically */
            }
            #accountModal > div:last-child > div:first-child {
                width: 100%; /* Tab bar full width */
                border-bottom: 1px solid #f2f2f2;
                padding: 0.5rem 0;
            }
            #accountModal #accountTabs button {
                padding: 0.8rem 1.2rem;
            }
            #accountModal > div:last-child > div:last-child {
                max-height: 60vh; /* Limit content height */
                padding: 1rem 1.2rem;
            }

            #menuDetailModal .menu-detail-content { width: 95%; }
        }

        /* Item Options Modal Styles */
        .options-modal {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            backdrop-filter: blur(5px);
            z-index: 1010; /* Higher than other modals */
            justify-content: center;
            align-items: center;
        }

        .options-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .options-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 480px; /* Limit max width */
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            animation: slideUp 0.4s ease;
        }

        .close-options {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            transition: background-color 0.2s ease;
        }
        .close-options:hover {
            background: rgba(0, 0, 0, 0.5);
        }
        .close-options i {
            font-size: 20px;
        }

        .options-image {
            width: 100%;
            height: 250px; /* Adjust height as needed */
            object-fit: cover;
            display: block;
        }

        .options-details {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Allow details to scroll if needed */
        }

        .options-details h3 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1d1d1f;
        }

        .options-group {
            margin-bottom: 1.5rem;
            border-top: 1px solid #f2f2f2;
            padding-top: 1.5rem;
        }

        .options-group-label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
            color: #1d1d1f;
        }

        .options-required {
            font-size: 0.8rem;
            color: #86868b;
            margin-left: 5px;
        }

        .options-select-prompt {
            font-size: 0.85rem;
            color: #86868b;
            margin-bottom: 1rem;
        }

        .options-choices {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap; /* Allow wrapping if needed */
        }

        .option-choice {
            flex: 1; /* Distribute space */
            min-width: calc(50% - 0.4rem); /* Aim for 2 columns */
            padding: 0.8rem 1rem;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: left;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }

        .option-choice span:first-child {
            font-size: 0.9rem;
            color: #1d1d1f;
            font-weight: 500;
        }

        .option-choice span:last-child {
            font-size: 0.85rem;
            color: #6e6e73;
        }

        .option-choice.selected {
            border-color: #0071e3;
            background-color: #f5faff;
        }

        .option-choice.selected span:first-child {
            font-weight: 600;
        }

        .options-footer {
            margin-top: auto; /* Push footer to bottom */
            padding-top: 1.5rem;
            border-top: 1px solid #f2f2f2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            background: #f5f5f7;
            border-radius: 20px;
            padding: 0.3rem;
        }

        .quantity-selector .quantity-btn {
            background: none;
            border: none;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #1d1d1f;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        .quantity-selector .quantity-btn:hover {
            background-color: #e8e8ed;
        }
        .quantity-selector .quantity-btn i {
            font-size: 18px;
        }

        .quantity-selector #optionsQuantity {
            padding: 0 0.8rem;
            font-size: 1rem;
            font-weight: 500;
            min-width: 20px; /* Ensure space for number */
            text-align: center;
        }

        .options-add-to-cart {
            flex-grow: 1; /* Take remaining space */
            background: #1d1d1f;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        .options-add-to-cart:hover {
            background: #333;
        }
        .options-add-to-cart #optionsTotalPrice {
            font-weight: 600;
        }

    </style>
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav class="nav-bar">
        <a href="#" class="nav-logo">
            <img src="https://lh3.googleusercontent.com/d/1u6bQ-JqAPk8ByCykJ42y3rvq8vx3U2C8" alt="Texan Lee Donuts Logo">
        </a>
        <div class="nav-links">
            <a href="#" class="nav-link">Home</a>
            <a href="#menu" class="nav-link">Menu</a>
            <a href="#about" class="nav-link">About Us</a>
            <a href="#contact" class="nav-link">Contact</a>
        </div>
        <div class="nav-account">
            <button class="login-btn" disabled>Log In</button> 
            <button class="order-online-btn" onclick="showOrderChoiceModal()">ORDER ONLINE</button> <!-- ORDER ONLINE 버튼 추가 -->
            <button class="cart-icon" onclick="toggleCart()">
                <span class="material-icons" style="font-size: 1.2rem;">shopping_cart</span>
                <span class="cart-badge" id="cartCount">0</span>
            </button>
        </div>
    </nav>

    <!-- 헤더 -->
    <header class="header">
        <div class="header-content">
            <h1>Texan Lee Donuts</h1>
            <p>Handcrafted with thoughtful design. Crafted with care.</p>
            <a href="#menu" class="header-cta">Explore Our Menu</a>
        </div>
    </header>

    <!-- 슬라이더 배너 -->
    <div class="slider-container">
        <div class="slider" id="slider">
            <div class="slide">
                <img src="https://lh3.googleusercontent.com/d/1oNILmuOtjILdaVIJPSSQdlrrubraYFY3" alt="Special Promotion">
                <div class="slide-content">
                    <h3>Summer Special Collection</h3>
                    <p>Enjoy our limited edition fruit-topped donuts perfect for summer!</p>
                    <button class="slide-btn" onclick="scrollToMenu()">Order Now</button>
                </div>
            </div>
            <div class="slide">
                <img src="https://images.unsplash.com/photo-1527515673510-8e0af7649b6f" alt="New Flavors">
                <div class="slide-content">
                    <h3>New Flavors Added</h3>
                    <p>Try our exciting new chocolate hazelnut and caramel sea salt flavors!</p>
                    <button class="slide-btn" onclick="scrollToMenu()">See Menu</button>
                </div>
            </div>
            <div class="slide">
                <img src="https://images.unsplash.com/photo-1495147466023-ac5c588e2e94" alt="Breakfast Bundle">
                <div class="slide-content">
                    <h3>Breakfast Bundle</h3>
                    <p>Get 6 donuts + 2 coffees for just $12.99 every morning from 7-10am!</p>
                    <button class="slide-btn" onclick="scrollToMenu()">Learn More</button>
                </div>
            </div>
        </div>
        <div class="slider-controls">
            <div class="slider-dot active" onclick="goToSlide(0)"></div>
            <div class="slider-dot" onclick="goToSlide(1)"></div>
            <div class="slider-dot" onclick="goToSlide(2)"></div>
        </div>
        <div class="slider-arrow slider-prev" onclick="prevSlide()">
            <span class="material-icons">chevron_left</span>
        </div>
        <div class="slider-arrow slider-next" onclick="nextSlide()">
            <span class="material-icons">chevron_right</span>
        </div>
    </div>

    <!-- 회사 소개 섹션 -->
    <section class="about-section" id="about">
        <div class="about-content">
            <h2>Our Story</h2>
            <p>Sweet Donut began with a simple mission: to create the perfect donut that balances exceptional taste, quality ingredients, and beautiful design. Founded in 2018, we've been delighting customers with our handcrafted creations made fresh daily.</p>
            <div class="about-features">
                <div class="feature">
                    <span class="material-icons feature-icon">eco</span>
                    <h3>Premium Ingredients</h3>
                    <p>We source only the finest ingredients to ensure each bite delivers exceptional quality and taste.</p>
                </div>
                <div class="feature">
                    <span class="material-icons feature-icon">restaurant</span>
                    <h3>Crafted Daily</h3>
                    <p>Every donut is made fresh each morning in our kitchen using traditional methods.</p>
                </div>
                <div class="feature">
                    <span class="material-icons feature-icon">palette</span>
                    <h3>Artistic Designs</h3>
                    <p>Our donuts aren't just delicious—they're beautiful works of edible art designed to delight.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 메인 컨텐츠 -->
    <main class="container" id="menu">
        <!-- 섹션 타이틀 -->
        <div class="section-title">
            <h2>Our Collection</h2>
            <p>Explore our signature donuts made with premium ingredients</p>
        </div>
        
        <!-- 카테고리 탭 -->
        <div class="category-tabs">
            <!-- 탭은 동적으로 생성됩니다 -->
        </div>

        <!-- 카테고리 콘텐츠도 동적으로 생성됩니다 -->
    </main>

    <!-- 장바구니 모달 -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <div class="cart-header">
                <h2><i class="material-icons">shopping_cart</i> Your Cart</h2>
                <button class="close-cart" onclick="toggleCart()"><i class="material-icons">close</i></button>
            </div>
            <div id="cartItems" class="cart-items">
                <!-- 장바구니 아이템들이 여기에 동적으로 추가됩니다 -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span class="cart-total-label">Total</span>
                    <span class="cart-total-amount">$ <span id="cartTotal">0</span> USD</span>
                </div>
                <button class="checkout-btn" onclick="showCheckoutModal()"> <!-- 함수 호출 변경 -->
                    <i class="material-icons">shopping_bag</i> Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Order Information / Payment 모달 (기존 orderModal 재활용) -->
    <div class="order-modal" id="orderModal">
        <div class="order-content">
            <div class="cart-header">
                <h2><i class="material-icons">payment</i> Payment Information</h2> <!-- 타이틀 변경 -->
                <button class="close-cart" onclick="closeOrderForm()"><i class="material-icons">close</i></button>
            </div>
            <form class="order-form" id="orderForm">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" placeholder="Enter your phone number" required>
                </div>
                <div class="form-group">
                    <label for="orderEmail">Email Address</label> <!-- 이메일 필드 추가 -->
                    <input type="email" id="orderEmail" placeholder="Enter your email" required>
                </div>
                <!-- 제거된 필드들 -->
                <!-- <div class="form-group">
                    <label for="address">Delivery Address</label>
                    <input type="text" id="address" placeholder="Enter your address" required>
                </div>
                <div class="form-group">
                    <label for="deliveryOption">Delivery Status</label>
                    <select id="deliveryOption" required>
                        <option value="pickup" selected>Pickup at Restaurant</option>
                        <option value="delivery" disabled>Home Delivery (Coming Soon)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pickup Time</label>
                    <div id="displayPickupTime" class="form-control-display"></div>
                </div> -->

                <!-- 가격 정보 표시 영역 추가 -->
                <div class="pricing-summary" style="border-top: 1px solid #eee; padding-top: 1.5rem; margin-top: 1rem;">
                     <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; color: #6e6e73;">
                        <span>Subtotal</span>
                        <span id="paymentSubtotal">$0.00</span>
                </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; color: #6e6e73;">
                        <span>Tax</span>
                        <span id="paymentTax">$0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: 600;">
                        <span>Total</span>
                        <span id="paymentTotal">$0.00</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="notes">Special Instructions (Optional)</label>
                    <textarea id="notes" rows="3" placeholder="Any special requests or notes for your order"></textarea>
                </div>
                <button type="submit" class="submit-order" onclick="submitFinalOrder(event)"> <!-- 함수 호출 변경 -->
                    <i class="material-icons">check_circle</i> Place Order <!-- 버튼 텍스트 변경 -->
                </button>
            </form>
        </div>
    </div>

    <!-- 로그인 모달 -->
    <div id="loginModal" class="order-modal">
        <div class="order-content">
            <div class="cart-header">
                <h2><i class="material-icons">login</i> Log In</h2>
                <button class="close-cart" onclick="toggleLoginModal()"><i class="material-icons">close</i></button>
            </div>
            <form class="order-form" id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="submit-order" onclick="handleLogin(event)">
                    <i class="material-icons">login</i> Log In
                </button>

                <!-- 소셜 로그인 버튼 추가 -->
                <div style="text-align: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #f2f2f2;">
                    <p style="color: #86868b; font-size: 0.9rem; margin-bottom: 1rem;">Or log in with:</p>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 0.8rem;">
                        <!-- Google 로그인 버튼 -->
                        <a href="/auth/google" class="social-login-btn google-btn">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 10px;"><path d="M17.64 9.20455C17.64 8.56636 17.5827 7.95273 17.4764 7.36364H9V10.845H13.8436C13.635 11.97 13.0009 12.9232 12.0477 13.5614V15.8195H14.9564C16.6582 14.2527 17.64 11.9455 17.64 9.20455Z" fill="#4285F4"/><path d="M9 18C11.43 18 13.4673 17.1941 14.9564 15.8195L12.0477 13.5614C11.2418 14.1014 10.2109 14.4205 9 14.4205C6.65591 14.4205 4.67182 12.8373 3.96409 10.71H0.957275V13.0418C2.43818 15.9832 5.48182 18 9 18Z" fill="#34A853"/><path d="M3.96409 10.71C3.78409 10.17 3.68182 9.59318 3.68182 9C3.68182 8.40682 3.78409 7.83 3.96409 7.29V4.95818H0.957275C0.347727 6.17182 0 7.54773 0 9C0 10.4523 0.347727 11.8282 0.957275 13.0418L3.96409 10.71Z" fill="#FBBC05"/><path d="M9 3.57955C10.3214 3.57955 11.5077 4.03364 12.4405 4.92545L15.0218 2.34409C13.4632 0.891818 11.43 0 9 0C5.48182 0 2.43818 2.01682 0.957275 4.95818L3.96409 7.29C4.67182 5.16273 6.65591 3.57955 9 3.57955Z" fill="#EA4335"/></svg>
                            <span>Continue with Google</span>
                        </a>
                        <!-- Apple 로그인 버튼 -->
                        <a href="/auth/apple" class="social-login-btn apple-btn">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 10px;"><path d="M14.5377 9.1406C14.5582 8.81475 14.599 8.4889 14.6604 8.16305H11.9651V10.327H14.5377C14.5377 10.327 14.0895 11.7043 12.908 12.5389C12.908 12.5389 13.4172 13.6597 14.8044 14.4534C14.8859 14.515 14.9674 14.5562 15.0489 14.5767C15.0081 14.5973 14.9875 14.6179 14.9468 14.6179C14.4783 14.9642 13.7037 15.2489 12.8883 15.29C11.5825 15.3517 10.8282 14.558 9.93137 14.558C9.01413 14.558 8.34137 15.3312 7.07637 15.3517C5.93391 15.3925 5.03704 14.7817 4.28276 14.0085C3.05861 12.8062 2.26361 10.7043 2.32486 8.6024C2.36561 7.08515 3.20137 5.7693 4.46637 4.93475C5.24088 4.41475 6.17861 4.1508 7.01511 4.13024C7.32137 4.13024 8.03486 4.1918 8.80937 4.64C8.78887 4.66055 8.76837 4.66055 8.74787 4.6811C8.09536 5.0889 7.54536 5.7811 7.56587 6.72755C7.58637 7.9298 8.66637 8.58165 9.05511 8.6022C9.07561 8.6022 9.07561 8.6022 9.09611 8.6022C9.15736 8.6022 10.1536 7.99135 10.1536 6.5836C10.1536 5.3608 9.40937 4.6811 9.15736 4.5172C9.93188 3.96675 10.9894 3.8037 11.9244 3.8653C12.1764 3.8653 13.3778 3.9884 14.4783 5.0484C14.4375 5.06895 14.417 5.0895 14.3965 5.11005C13.4996 5.74024 12.9089 6.96345 12.9496 8.2247C12.9701 8.9789 13.4172 9.8343 14.5377 9.1406Z" fill="white"/><path d="M10.4199 3.20949C10.7874 2.78169 11.0804 2.29228 11.2919 1.76208C10.5376 1.35428 9.68116 1.19128 8.84741 1.19128C7.52116 1.19128 6.31966 1.70048 5.42266 2.57428C5.03391 2.89968 4.70616 3.28669 4.44566 3.71449C5.05691 3.98869 5.77041 4.04988 6.44316 4.04988C7.48041 4.04988 8.43616 3.76308 9.17791 3.29128C9.58566 3.01708 9.99341 2.72238 10.4199 3.20949Z" fill="white"/></svg>
                            <span>Continue with Apple</span>
                        </a>
                        <!-- Facebook 로그인 버튼 -->
                        <a href="/auth/facebook" class="social-login-btn facebook-btn">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 10px;"><path d="M17 9C17 4.58187 13.4181 1 9 1C4.58187 1 1 4.58187 1 9C1 12.9384 3.77313 16.1531 7.375 16.8581V11.625H5.375V9H7.375V7.14375C7.375 5.17594 8.55719 4.125 10.3653 4.125C11.2319 4.125 12.125 4.28125 12.125 4.28125V6.5H10.9834C9.99781 6.5 9.75 7.04063 9.75 7.54906V9H12.0319L11.6731 11.625H9.75V16.8581C13.3519 16.1531 16.125 12.9384 16.125 9H17Z" fill="white"/></svg>
                            <span>Continue with Facebook</span>
                        </a>
                    </div>
                </div>

                <p style="text-align: center; margin-top: 1.5rem; color: #86868b; font-size: 0.9rem;">
                    Don't have an account? <a href="#" style="color: #0071e3; text-decoration: none;" onclick="toggleRegisterModal(event)">Create Account</a>
                </p>
            </form>
        </div>
    </div>

    <!-- 회원가입 모달 -->
    <div class="order-modal" id="registerModal">
        <div class="order-content">
            <div class="cart-header">
                <h2><i class="material-icons">person_add</i> Create Account</h2>
                <button class="close-cart" onclick="toggleRegisterModal()"><i class="material-icons">close</i></button>
            </div>
            <form class="order-form" id="registerForm">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email Address</label>
                    <input type="email" id="registerEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">Phone Number</label>
                    <input type="tel" id="registerPhone" placeholder="Enter your phone number" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Create a password" required pattern=".{8,}" title="Password must be at least 8 characters">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm your password" required>
                </div>
                <button type="submit" class="submit-order" onclick="handleRegister(event)">
                    <i class="material-icons">person_add</i> Create Account
                </button>
                <p style="text-align: center; margin-top: 1rem; color: #86868b; font-size: 0.9rem;">
                    Already have an account? <a href="#" style="color: #0071e3; text-decoration: none;" onclick="backToLogin(event)">Log in</a>
                </p>
            </form>
        </div>
    </div>

    <!-- 사용자 계정 대시보드 모달 -->
    <div class="order-modal" id="accountModal">
        <div class="order-content" style="max-width: 800px;">
            <div class="cart-header">
                <h2><i class="material-icons">account_circle</i> My Account</h2>
                <button class="close-cart" onclick="toggleAccountModal()"><i class="material-icons">close</i></button>
            </div>
            <div style="padding: 0; display: flex; border-bottom: 1px solid #f2f2f2;">
                <div style="width: 200px; background: #f5f5f7; padding: 1.5rem 0;">
                    <ul id="accountTabs" style="list-style: none; padding: 0;">
                        <li class="account-tab active" data-tab="orderHistory">
                            <button style="width: 100%; text-align: left; padding: 0.8rem 1.5rem; background: none; border: none; cursor: pointer; font-size: 0.9rem;">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">receipt</i> Order History
                            </button>
                        </li>
                        <li class="account-tab" data-tab="personalInfo">
                            <button style="width: 100%; text-align: left; padding: 0.8rem 1.5rem; background: none; border: none; cursor: pointer; font-size: 0.9rem;">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">person</i> Personal Info
                            </button>
                        </li>
                        <li class="account-tab" data-tab="favorites">
                            <button style="width: 100%; text-align: left; padding: 0.8rem 1.5rem; background: none; border: none; cursor: pointer; font-size: 0.9rem;">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">favorite</i> Favorites
                            </button>
                        </li>
                        <li class="account-tab" data-tab="addresses">
                            <button style="width: 100%; text-align: left; padding: 0.8rem 1.5rem; background: none; border: none; cursor: pointer; font-size: 0.9rem;">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">location_on</i> Addresses
                            </button>
                        </li>
                        <li>
                            <button onclick="logout()" style="width: 100%; text-align: left; padding: 0.8rem 1.5rem; background: none; border: none; cursor: pointer; font-size: 0.9rem; color: #ff3b30;">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">exit_to_app</i> Log Out
                            </button>
                        </li>
                    </ul>
                </div>
                <div style="flex: 1; padding: 1.5rem 2rem; overflow-y: auto; max-height: 500px;">
                    <div id="orderHistory" class="account-tab-content active">
                        <h3 style="font-size: 1.2rem; margin-bottom: 1.5rem; color: #1d1d1f;">Order History</h3>
                        <div id="ordersList">
                            <div style="background: #f9f9f9; padding: 1.2rem; border-radius: 12px; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <div style="font-weight: 600;">Order #12345</div>
                                    <div style="color: #86868b; font-size: 0.9rem;">June 15, 2023</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                    <div style="color: #86868b; font-size: 0.9rem;">3 items</div>
                                    <div style="font-weight: 500;">$24.97</div>
                                </div>
                                <div style="font-size: 0.9rem; padding-top: 0.8rem; border-top: 1px solid #eee;">
                                    <span style="display: inline-block; background: #e8f0fd; color: #0071e3; padding: 0.3rem 0.8rem; border-radius: 30px; font-size: 0.8rem;">Delivered</span>
                                </div>
                            </div>
                            <div style="background: #f9f9f9; padding: 1.2rem; border-radius: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <div style="font-weight: 600;">Order #12339</div>
                                    <div style="color: #86868b; font-size: 0.9rem;">June 10, 2023</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                    <div style="color: #86868b; font-size: 0.9rem;">2 items</div>
                                    <div style="font-weight: 500;">$12.98</div>
                                </div>
                                <div style="font-size: 0.9rem; padding-top: 0.8rem; border-top: 1px solid #eee;">
                                    <span style="display: inline-block; background: #e8f0fd; color: #0071e3; padding: 0.3rem 0.8rem; border-radius: 30px; font-size: 0.8rem;">Delivered</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="personalInfo" class="account-tab-content">
                        <h3 style="font-size: 1.2rem; margin-bottom: 1.5rem; color: #1d1d1f;">Personal Information</h3>
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="profileName">Full Name</label>
                                <input type="text" id="profileName" value="John Doe">
                            </div>
                            <div class="form-group">
                                <label for="profileEmail">Email Address</label>
                                <input type="email" id="profileEmail" value="john.doe@example.com">
                            </div>
                            <div class="form-group">
                                <label for="profilePhone">Phone Number</label>
                                <input type="tel" id="profilePhone" value="(123) 456-7890">
                            </div>
                            <button type="submit" class="submit-order" style="margin-top: 1rem;">
                                Save Changes
                            </button>
                        </form>
                    </div>
                    <div id="favorites" class="account-tab-content">
                        <h3 style="font-size: 1.2rem; margin-bottom: 1.5rem; color: #1d1d1f;">My Favorites</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                            <div style="background: #f9f9f9; padding: 1rem; border-radius: 12px; width: calc(50% - 0.5rem);">
                                <img src="https://images.unsplash.com/photo-1527515545081-5db817172677" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 0.8rem;">
                                <h4 style="font-size: 1rem; margin-bottom: 0.3rem;">CHOCOLATE</h4>
                                <p style="color: #86868b; font-size: 0.85rem; margin-bottom: 0.8rem;">Rich chocolate donut topped with chocolate icing</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 600;">$1.09</div>
                                    <button style="background: #0071e3; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; cursor: pointer;">Add to Cart</button>
                                </div>
                            </div>
                            <div style="background: #f9f9f9; padding: 1rem; border-radius: 12px; width: calc(50% - 0.5rem);">
                                <img src="https://images.unsplash.com/photo-1557925923-cd4648e211a0" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 0.8rem;">
                                <h4 style="font-size: 1rem; margin-bottom: 0.3rem;">BLUEBERRY</h4>
                                <p style="color: #86868b; font-size: 0.85rem; margin-bottom: 0.8rem;">Cake donut filled with sweet blueberries</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 600;">$1.59</div>
                                    <button style="background: #0071e3; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; cursor: pointer;">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="addresses" class="account-tab-content">
                        <h3 style="font-size: 1.2rem; margin-bottom: 1.5rem; color: #1d1d1f;">Delivery Addresses</h3>
                        <div style="background: #f9f9f9; padding: 1.2rem; border-radius: 12px; margin-bottom: 1rem; position: relative;">
                            <div style="position: absolute; top: 1rem; right: 1rem; font-size: 0.8rem; color: #0071e3;">Default</div>
                            <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">Home</h4>
                            <p style="color: #86868b; font-size: 0.9rem; margin-bottom: 0.5rem;">123 Main Street, Apt 4B</p>
                            <p style="color: #86868b; font-size: 0.9rem;">New York, NY 10001</p>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button style="background: none; border: 1px solid #d2d2d7; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; cursor: pointer;">Edit</button>
                                <button style="background: none; border: 1px solid #d2d2d7; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; cursor: pointer;">Remove</button>
                            </div>
                        </div>
                        <div style="background: #f9f9f9; padding: 1.2rem; border-radius: 12px; margin-bottom: 1rem;">
                            <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">Work</h4>
                            <p style="color: #86868b; font-size: 0.9rem; margin-bottom: 0.5rem;">456 Business Ave, Floor 8</p>
                            <p style="color: #86868b; font-size: 0.9rem;">New York, NY 10022</p>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button style="background: none; border: 1px solid #d2d2d7; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; cursor: pointer;">Edit</button>
                                <button style="background: none; border: 1px solid #d2d2d7; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; cursor: pointer;">Remove</button>
                                <button style="background: none; border: 1px solid #0071e3; color: #0071e3; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; cursor: pointer;">Set as Default</button>
                            </div>
                        </div>
                        <button style="width: 100%; background: none; border: 1px dashed #d2d2d7; padding: 0.8rem; border-radius: 12px; margin-top: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; color: #86868b;">
                            <i class="material-icons" style="font-size: 1rem;">add</i> Add New Address
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 메뉴 상세 모달 -->
    <div class="menu-detail-modal" id="menuDetailModal">
        <div class="menu-detail-content">
            <div class="cart-header">
                <h2><i class="material-icons">restaurant_menu</i> <span id="detailTitle">Donut Details</span></h2>
                <button class="close-cart" onclick="closeMenuDetail()"><i class="material-icons">close</i></button>
            </div>
            <div class="menu-detail-header">
                <img src="" alt="Donut" class="menu-detail-img" id="detailImage">
                <div class="menu-detail-info">
                    <h3 id="detailName"></h3>
                    <p id="detailDescription"></p>
                    <div class="menu-detail-price">$ <span id="detailPrice"></span> USD</div>
                    <button class="add-to-cart" id="detailAddToCartBtn">
                        <span>Add to Cart</span>
                    </button>
                </div>
            </div>
            <div class="menu-detail-body">
                <h4 class="ingredients-title">Ingredients</h4>
                <div class="ingredients-list" id="detailIngredients">
                    <!-- Ingredients will be added dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- 로딩 오버레이 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Processing your order...</p>
        </div>
    </div>

    <!-- 푸터 -->
    <footer style="background: #f5f5f7; padding: 4rem 0 2rem; text-align: center;" id="contact">
        <div style="max-width: 980px; margin: 0 auto; padding: 0 2rem;">
            <h3 style="font-size: 1.4rem; margin-bottom: 1.5rem; color: #1d1d1f;">Texan Lee Donuts</h3>
            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 3rem; margin-bottom: 3rem;">
                <div style="flex: 1; min-width: 200px; text-align: left;">
                    <h4 style="font-size: 1rem; margin-bottom: 1rem; color: #1d1d1f;">Visit Us</h4>
                    <p style="color: #86868b; font-size: 0.9rem; line-height: 1.6;">
                        123 Donut Street<br>
                        Sweetville, NY 10001<br>
                        (123) 456-7890
                    </p>
                </div>
                <div style="flex: 1; min-width: 200px; text-align: left;">
                    <h4 style="font-size: 1rem; margin-bottom: 1rem; color: #1d1d1f;">Opening Hours</h4>
                    <p style="color: #86868b; font-size: 0.9rem; line-height: 1.6;">
                        Monday - Friday: 7am - 7pm<br>
                        Saturday: 8am - 8pm<br>
                        Sunday: 8am - 6pm
                    </p>
                </div>
                <div style="flex: 1; min-width: 200px; text-align: left;">
                    <h4 style="font-size: 1rem; margin-bottom: 1rem; color: #1d1d1f;">Connect</h4>
                    <p style="color: #86868b; font-size: 0.9rem; line-height: 1.6;">
                        <a href="#" style="color: #86868b; text-decoration: none; display: block; margin-bottom: 0.5rem;">Facebook</a>
                        <a href="#" style="color: #86868b; text-decoration: none; display: block; margin-bottom: 0.5rem;">Instagram</a>
                        <a href="#" style="color: #86868b; text-decoration: none; display: block; margin-bottom: 0.5rem;">Twitter</a>
                    </p>
                </div>
            </div>
            <p style="color: #86868b; font-size: 0.8rem; margin-top: 2rem; border-top: 1px solid #d2d2d7; padding-top: 2rem;">
                © 2023 Sweet Donut. All rights reserved.
            </p>
        </div>
    </footer>

    <!-- 주문 선택 모달 -->
    <div class="order-modal" id="orderChoiceModal">
        <div class="order-content" style="max-width: 400px; padding: 2rem;">
            <div class="cart-header" style="padding: 0 0 1.5rem; border: none;">
                <h2>How would you like to order?</h2>
                <button class="close-cart" onclick="closeOrderChoiceModal()"><i class="material-icons">close</i></button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <button class="order-choice-btn pickup-btn" onclick="selectPickup()">
                    <span class="material-icons">storefront</span>
                    PICKUP
                    <span class="material-icons arrow">chevron_right</span>
                </button>
                <button class="order-choice-btn doordash-btn" onclick="selectDoorDash()">
                    <span class="material-icons">delivery_dining</span>
                    DOORDASH
                    <span class="material-icons arrow">chevron_right</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Pickup Time 선택 모달 -->
    <div class="order-modal" id="pickupTimeModal">
        <div class="order-content" style="max-width: 450px;">
            <div class="cart-header">
                <h2><i class="material-icons">calendar_today</i> Select Pickup Time</h2>
                <button class="close-cart" onclick="closePickupTimeModal()"><i class="material-icons">close</i></button>
            </div>
            <div class="order-form" style="padding-top: 1rem;">
                <div class="form-group">
                    <label for="pickupDate">Pickup Date</label>
                    <input type="date" id="pickupDate" required>
                </div>
                <div class="form-group">
                    <label for="pickupTimeSelect">Pickup Time</label> <!-- Label for 연동 제거 필요 -->
                    <!-- <input type="time" id="pickupTimeSelect" required min="05:30" max="11:30" step="900"> --> <!-- 기존 input 주석 처리 또는 제거 -->
                    <div class="custom-time-select">
                        <div class="time-select-trigger" id="timeSelectTrigger" onclick="toggleTimeDropdown(event)">
                            <span id="selectedTimeText">Select a time</span>
                            <i class="material-icons">arrow_drop_down</i>
                        </div>
                        <div class="time-dropdown" id="timeDropdown">
                            <!-- 시간 옵션은 JS로 채워집니다 -->
                        </div>
                    </div>
                    <input type="hidden" id="pickupTimeHidden" name="pickupTimeValue"> <!-- 숨겨진 input 추가 -->
                     <small style="color: #86868b; font-size: 0.8rem; margin-top: 0.3rem;">Pickup available between 5:30 AM and 11:30 AM.</small>
                </div>
                <button type="button" class="submit-order" onclick="confirmPickupTime()" style="margin-top: 1.5rem;">
                    <i class="material-icons">check_circle</i> Confirm Pickup Time
                </button>
            </div>
        </div>
    </div>

    <!-- Checkout 모달 -->
    <div class="order-modal" id="checkoutModal">
        <div class="order-content" style="max-width: 550px;">
            <div class="cart-header">
                <h2><i class="material-icons">receipt_long</i> Review Your Order</h2>
                <button class="close-cart" onclick="closeCheckoutModal()"><i class="material-icons">close</i></button>
            </div>
            <div class="checkout-body" style="padding: 1.5rem 2rem 2rem;">
                <!-- Store Info -->
                <div class="store-info" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.3rem;">Texan Lee Donuts</h3>
                    <p style="color: #6e6e73; font-size: 0.9rem;">1490 Valley Ridge Blvd #104, Lewisville, TX 75077</p> <!-- 주소 변경 -->
                </div>

                <!-- Pickup Details -->
                <div class="pickup-details" style="margin-bottom: 1.5rem; border: 1px solid #e5e5e5; border-radius: 12px; padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem;">
                        <div style="display: flex; align-items: center; gap: 0.8rem; font-weight: 500;">
                            <i class="material-icons">storefront</i>
                            <span>Pickup</span>
                        </div>
                        <a href="#" onclick="editPickupTime(event)" style="font-size: 0.85rem; color: #0071e3; text-decoration: none;">Edit</a>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.8rem; margin-bottom: 0.8rem;">
                        <i class="material-icons">calendar_today</i>
                        <span id="checkoutPickupTime">ASAP (Est. 15-20 minutes)</span> <!-- JS로 업데이트될 부분 -->
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.8rem;">
                        <i class="material-icons">location_on</i>
                        <span style="color: #6e6e73; font-size: 0.9rem;">Pickup at 1490 Valley Ridge Blvd #104</span> <!-- 주소 변경 -->
                    </div>
                </div>

                <!-- Map Placeholder -->
                <!-- <div id="checkoutMap" style="height: 150px; background-color: #f0f0f0; border-radius: 8px; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; color: #888; font-size: 0.9rem;">
                    (Map Placeholder)
                </div> -->

                <!-- Order Details -->
                <div class="order-details-container">
                    <button class="order-details-header" onclick="toggleOrderDetails()" style="width: 100%; display: flex; justify-content: space-between; align-items: center; background: none; border: none; padding: 0.5rem 0; margin-bottom: 0.5rem; cursor: pointer;">
                        <h4 style="font-size: 1rem; font-weight: 600;">Order details (<span id="checkoutItemCount">0</span>)</h4>
                        <i class="material-icons" id="orderDetailsToggleIcon">expand_more</i>
                    </button>
                    <div id="checkoutOrderItems" style="display: none; border-top: 1px solid #eee; padding-top: 1rem; margin-bottom: 1.5rem;">
                        <!-- 주문 아이템 목록 (JS로 채워짐) -->
                    </div>
                </div>

                <!-- Pricing -->
                <div class="pricing-summary" style="border-top: 1px solid #eee; padding-top: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; color: #6e6e73;">
                        <span>Subtotal</span>
                        <span id="checkoutSubtotal">$0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; color: #6e6e73;">
                        <span>Tax (<span id="checkoutTaxRate">8.25</span>%)</span> <!-- 세율 표시 (예시) -->
                        <span id="checkoutTax">$0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: 600;">
                        <span>Total</span>
                        <span id="checkoutTotal">$0.00</span>
                    </div>
                </div>

                <!-- Checkout Button -->
                <button class="submit-order" onclick="proceedToPayment(event)" style="margin-top: 2rem; width: 100%;">
                     <i class="material-icons">shopping_bag</i> Complete Order
                </button>
            </div>
        </div>
    </div>

    <!-- Item Options Modal -->
    <div class="options-modal" id="optionsModal">
        <div class="options-content">
            <button class="close-options" onclick="closeOptionsModal()"><i class="material-icons">close</i></button>
            <img id="optionsImage" src="" alt="Menu Item Image" class="options-image">
            <div class="options-details">
                <h3 id="optionsTitle">Item Name</h3>
                
                <div class="options-group" id="optionsSelectionGroup">
                    <label id="optionsGroupLabel" class="options-group-label">Select Option</label>
                    <span class="options-required">Required*</span>
                    <p class="options-select-prompt">Please select 1</p>
                    <div id="optionsChoices" class="options-choices">
                        <!-- Option buttons will be dynamically added here -->
                        <!-- Example: 
                        <button class="option-choice" data-price-modifier="1.75">
                            <span>6 count</span>
                            <span>+$1.75</span>
                        </button>
                        -->
                    </div>
                </div>

                <div class="options-footer">
                    <div class="quantity-selector">
                        <button class="quantity-btn" onclick="updateOptionsQuantity(-1)"><i class="material-icons">remove</i></button>
                        <span id="optionsQuantity">1</span>
                        <button class="quantity-btn" onclick="updateOptionsQuantity(1)"><i class="material-icons">add</i></button>
                    </div>
                    <button class="options-add-to-cart" onclick="addOptionsToCart()">
                        <span>Add to Cart</span>
                        <span id="optionsTotalPrice">$0.00</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 장바구니 데이터
        let cart = [];
        let isPickupActive = false; // PICKUP 활성화 상태 변수
        
        // 구글 시트 API URL (기존 주문 처리 URL과 동일)
        const API_URL = 'https://script.google.com/macros/s/AKfycbzuIZT-pRiC4o53u0ruWefsfRqyDasNQqW7nOfs5ipHZ0PlicbFP3FixcjDZv4rha8QXQ/exec';
        const SHEET_ID = '1_3vfkReCDiWfQAIHwfC2vNPmJZk-EAhIO6AAsmrYms4';
        const REFRESH_INTERVAL = 5 * 60 * 1000; // 5분마다 메뉴 새로고침
        
        // 슬라이더 기능
        let currentSlide = 0;
        const totalSlides = document.querySelectorAll('.slide').length;
        
        function showSlide(index) {
            const slider = document.getElementById('slider');
            if (!slider) return;
            
            if (index < 0) index = totalSlides - 1;
            if (index >= totalSlides) index = 0;
            
            currentSlide = index;
            slider.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            // 도트 표시기 업데이트
            document.querySelectorAll('.slider-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlide);
            });
        }
        
        function nextSlide() {
            showSlide(currentSlide + 1);
        }
        
        function prevSlide() {
            showSlide(currentSlide - 1);
        }
        
        function goToSlide(index) {
            showSlide(index);
        }
        
        // 슬라이더 자동 재생
        let slideInterval;
        
        function startSlideShow() {
            slideInterval = setInterval(() => {
                nextSlide();
            }, 5000);
        }
        
        function stopSlideShow() {
            clearInterval(slideInterval);
        }
        
        // 메뉴로 스크롤
        function scrollToMenu() {
            document.getElementById('menu').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // 로그인 모달 토글
        function toggleLoginModal() {
            const loginModal = document.getElementById('loginModal');
            loginModal.classList.toggle('show');
        }

        // 회원가입 모달 토글
        function toggleRegisterModal(event) {
            if (event) event.preventDefault();
            
            // 로그인 모달 닫기
            document.getElementById('loginModal').classList.remove('show');
            
            // 회원가입 모달 열기
            document.getElementById('registerModal').classList.toggle('show');
        }

        // 로그인 모달로 돌아가기
        function backToLogin(event) {
            if (event) event.preventDefault();
            
            // 회원가입 모달 닫기
            document.getElementById('registerModal').classList.remove('show');
            
            // 로그인 모달 열기
            document.getElementById('loginModal').classList.add('show');
        }

        // 계정 모달 토글
        function toggleAccountModal() {
            const accountModal = document.getElementById('accountModal');
            accountModal.classList.toggle('show');
        }

        // 로그인 처리
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Please enter both email and password.');
                return;
            }
            
            // 실제 구현에서는 서버로 로그인 요청을 보내야 합니다.
            // 여기서는 간단한 로컬 로그인 시뮬레이션만 합니다.
            
            // 로딩 표시
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.querySelector('.loading-content p').textContent = 'Logging in...';
            
            // 로그인 시뮬레이션 (1초 후 처리 완료)
            setTimeout(() => {
                // 로딩 숨기기
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // 로그인 성공 처리
                const userInfo = {
                    name: 'John Doe',
                    email: email,
                    isLoggedIn: true
                };
                
                // 로컬 스토리지에 사용자 정보 저장
                localStorage.setItem('userInfo', JSON.stringify(userInfo));
                
                // 로그인 모달 닫기
                toggleLoginModal();
                
                // UI 업데이트
                updateUserUI(userInfo);
                
                // 사용자 환영 메시지
                alert(`Welcome back, ${userInfo.name}!`);
            }, 1000);
        }

        // 회원가입 처리
        function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!name || !email || !phone || !password) {
                alert('Please fill in all required fields.');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            
            // 실제 구현에서는 서버로 회원가입 요청을 보내야 합니다.
            // 여기서는 간단한 로컬 회원가입 시뮬레이션만 합니다.
            
            // 로딩 표시
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.querySelector('.loading-content p').textContent = 'Creating your account...';
            
            // 회원가입 시뮬레이션 (1초 후 처리 완료)
            setTimeout(() => {
                // 로딩 숨기기
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // 회원가입 성공 처리
                const userInfo = {
                    name: name,
                    email: email,
                    phone: phone,
                    isLoggedIn: true
                };
                
                // 로컬 스토리지에 사용자 정보 저장
                localStorage.setItem('userInfo', JSON.stringify(userInfo));
                
                // 회원가입 모달 닫기
                document.getElementById('registerModal').classList.remove('show');
                
                // UI 업데이트
                updateUserUI(userInfo);
                
                // 사용자 환영 메시지
                alert(`Welcome to Sweet Donut, ${name}!`);
            }, 1000);
        }

        // 로그아웃 처리
        function logout() {
            // 로컬 스토리지에서 사용자 정보 제거
            localStorage.removeItem('userInfo');
            
            // 계정 모달 닫기
            toggleAccountModal();
            
            // UI 업데이트
            updateUserUI(null);
            
            // 로그아웃 메시지
            alert('You have been logged out.');
        }

        // 사용자 UI 업데이트
        function updateUserUI(userInfo) {
            const loginBtn = document.querySelector('.login-btn');
            
            if (userInfo && userInfo.isLoggedIn) {
                // 로그인 상태일 때
                loginBtn.textContent = userInfo.name.split(' ')[0]; // 첫 번째 이름만 표시
                // loginBtn.onclick = toggleAccountModal; // 이 부분을 주석 처리 또는 삭제
                
                // 계정 모달 업데이트
                if (document.getElementById('profileName')) {
                    document.getElementById('profileName').value = userInfo.name;
                    document.getElementById('profileEmail').value = userInfo.email;
                    document.getElementById('profilePhone').value = userInfo.phone || '';
                }
            } else {
                // 로그아웃 상태일 때
                loginBtn.textContent = 'Log In';
                // loginBtn.onclick = toggleLoginModal; // 이 부분을 주석 처리 또는 삭제
            }
        }

        // 메뉴 상세 정보 표시
        function showMenuDetail(name, description, price, imageUrl, category) {
            const modal = document.getElementById('menuDetailModal');
            
            // 기본 정보 설정
            document.getElementById('detailTitle').textContent = `${name} Details`;
            document.getElementById('detailName').textContent = name;
            document.getElementById('detailDescription').textContent = description || 'A delicious handcrafted donut made with premium ingredients.';
            document.getElementById('detailPrice').textContent = price.toLocaleString();
            document.getElementById('detailImage').src = imageUrl;
            document.getElementById('detailImage').alt = name;
            
            // 장바구니 추가 버튼 설정
            const addToCartBtn = document.getElementById('detailAddToCartBtn');
            addToCartBtn.onclick = function() {
                addToCart(name, price);
                closeMenuDetail();
            };
            
            // 재료 정보 추가
            const ingredientsContainer = document.getElementById('detailIngredients');
            ingredientsContainer.innerHTML = '';
            
            // 카테고리에 따라 다른 재료 제공
            const ingredients = getIngredients(name, category);
            
            ingredients.forEach(ingredient => {
                const item = document.createElement('div');
                item.className = 'ingredient-item';
                item.textContent = ingredient;
                ingredientsContainer.appendChild(item);
            });
            
            // 모달 표시
            modal.classList.add('show');
        }
        
        // 도넛 종류별 재료 정보 (예시)
        function getIngredients(name, category) {
            const lowerName = name.toLowerCase();
            
            // 기본 재료
            const baseIngredients = ['Enriched Flour', 'Sugar', 'Vegetable Oil', 'Water', 'Yeast'];
            
            // 초코 도넛 재료
            if (lowerName.includes('chocolate') || lowerName.includes('초코')) {
                return [...baseIngredients, 'Cocoa Powder', 'Chocolate Chips', 'Milk Solids', 'Natural Flavor'];
            }
            
            // 블루베리 도넛 재료
            else if (lowerName.includes('blueberry') || lowerName.includes('블루베리')) {
                return [...baseIngredients, 'Dried Blueberries', 'Blueberry Puree', 'Natural Flavor', 'Citric Acid'];
            }
            
            // 아침 식사류 재료
            else if (category === 'breakfast') {
                return ['Enriched Flour', 'Water', 'Eggs', 'Salt', 'Cheese', 'Ham', 'Butter', 'Spices'];
            }
            
            return baseIngredients;
        }
         
        // 메뉴 상세 모달 닫기
        function closeMenuDetail() {
            document.getElementById('menuDetailModal').classList.remove('show');
        }
        
        // 메뉴 데이터 가져오기
        async function fetchMenuData() {
            // 로딩 표시
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.querySelector('.loading-content p').textContent = '메뉴 불러오는 중...';
            
            try {
                // 1. JSONP를 통해 데이터 가져오기 시도
                try {
                    console.log('JSONP를 통한 메뉴 데이터 요청 시도...');
                    const menuDataFromJsonp = await fetchMenuDataJSONP();
                    
                    // JSONP 에러 확인
                    if (menuDataFromJsonp && menuDataFromJsonp._jsonpError) {
                        console.log('JSONP 사용 불가, 다른 방법으로 진행합니다.');
                    } else {
                        // 정상적인 JSONP 응답 처리
                        // 로딩 숨기기
                        setTimeout(() => {
                            document.getElementById('loadingOverlay').style.display = 'none';
                        }, 500);
                        
                        console.log('JSONP로부터 메뉴 데이터 성공적으로 로드됨');
                        return menuDataFromJsonp;
                    }
                } catch (jsonpError) {
                    console.warn('다른 데이터 접근 방식으로 전환합니다.', jsonpError.message);
                }
                
                // 2. 직접 이미지 URL 접근 시도
                try {
                    const directImageData = await fetchDirectImageUrls();
                    if (directImageData) {
                        // 로딩 숨기기
                        setTimeout(() => {
                            document.getElementById('loadingOverlay').style.display = 'none';
                        }, 500);
                        
                        console.log('직접 이미지 URL 접근 성공');
                        return directImageData;
                    }
                } catch (directError) {
                    console.warn('직접 이미지 URL 접근 실패:', directError.message);
                }
                
                console.warn('CSV 방식으로 시도합니다');
                
                // 3. CSV 방식으로 시도
                // Google Sheets CSV 형식으로 데이터 가져오기
                const response = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=메뉴 목록`);
                const csvText = await response.text();
                
                console.log('CSV 원본 데이터 샘플:', csvText.substring(0, 200));
                
                // CSV 파싱을 간소화하면서 큰따옴표 처리에 주의
                const rows = csvText.split('\n');
                const lines = [];
                
                for (let row of rows) {
                    // 빈 줄 무시
                    if (!row.trim()) continue;
                    
                    const fields = [];
                    let inQuote = false;
                    let field = '';
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        
                        if (char === '"') {
                            inQuote = !inQuote;
                        } else if (char === ',' && !inQuote) {
                            fields.push(field.replace(/^"|"$/g, ''));
                            field = '';
                        } else {
                            field += char;
                        }
                    }
                    
                    fields.push(field.replace(/^"|"$/g, ''));
                    lines.push(fields);
                }
                
                console.log('파싱된 CSV 데이터 샘플:', lines.slice(0, 2));
                
                const headers = lines[0].map(header => header.toLowerCase().trim());
                
                const categoryIndex = headers.indexOf('category');
                const nameIndex = headers.indexOf('name');
                const descriptionIndex = headers.indexOf('description');
                const priceIndex = headers.indexOf('price');
                const imageUrlIndex = headers.indexOf('imageurl');
                
                if (categoryIndex === -1 || nameIndex === -1 || priceIndex === -1) {
                    throw new Error('필수 열(category, name, price)이 없습니다.');
                }
                
                // 카테고리 동적으로 처리
                const menuData = {};
                
                // 데이터에서 고유 카테고리 추출
                const categories = new Set();
                
                // 데이터 행 처리 - 첫 번째 패스: 카테고리 수집
                for (let i = 1; i < lines.length; i++) {
                    const row = lines[i];
                    const category = row[categoryIndex]?.trim();
                    
                    if (category) {
                        categories.add(category);
                    }
                }
                
                // 발견된 모든 카테고리에 대한 객체 생성
                categories.forEach(category => {
                    menuData[category] = [];
                });
                
                // 기본 카테고리도 확인 (없으면 추가)
                if (!menuData['donut']) menuData['donut'] = [];
                if (!menuData['cake-donut']) menuData['cake-donut'] = [];
                if (!menuData['breakfast']) menuData['breakfast'] = [];
                
                console.log('발견된 카테고리:', Object.keys(menuData));
                
                // 데이터 행 처리 - 두 번째 패스: 메뉴 아이템 추가
                for (let i = 1; i < lines.length; i++) {
                    const row = lines[i];
                    const category = row[categoryIndex]?.trim();
                    const name = row[nameIndex]?.trim();
                    const price = parseFloat(row[priceIndex]);
                    
                    // 값 로깅
                    console.log(`행 ${i} 데이터: category=${category}, name=${name}, price=${price}, imageUrl=${row[imageUrlIndex]}`);
                    
                    if (!category || !name || isNaN(price)) continue;
                    
                    const menuItem = {
                        name: name,
                        price: price,
                        description: descriptionIndex !== -1 ? row[descriptionIndex]?.trim() || '' : '',
                        imageUrl: imageUrlIndex !== -1 ? row[imageUrlIndex]?.trim() || 'https://images.unsplash.com/photo-1551024506-0bccd828d307' : 'https://images.unsplash.com/photo-1551024506-0bccd828d307'
                    };
                    
                    // 이미지 URL 안전성 검증
                    if (menuItem.imageUrl) {
                        // 구글 드라이브 URL 변환 시도
                        if (menuItem.imageUrl.includes('drive.google.com/file/d/')) {
                            const convertedUrl = convertGoogleDriveUrl(menuItem.imageUrl);
                            if (convertedUrl) {
                                console.log('CSV 데이터에서 구글 드라이브 URL 변환:', menuItem.imageUrl, ' -> ', convertedUrl);
                                menuItem.imageUrl = convertedUrl;
                            }
                        }
                        
                        try {
                            // URL이 올바른 형식인지 확인
                            new URL(menuItem.imageUrl);
                            console.log('유효한 이미지 URL:', menuItem.imageUrl);
                        } catch (e) {
                            console.log('유효하지 않은 URL 형식:', menuItem.imageUrl);
                            menuItem.imageUrl = 'https://images.unsplash.com/photo-1551024506-0bccd828d307';
                        }
                    }
                    
                    if (menuData.hasOwnProperty(category)) {
                        menuData[category].push(menuItem);
                    }
                }
                
                // 로딩 숨기기
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 500);
                
                return menuData;
            } catch (error) {
                // 모든 방법이 실패한 경우
                console.error('메뉴 데이터를 가져오는 중 오류가 발생했습니다:', error);
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // 기본 메뉴 데이터 반환
                return getDefaultMenuData();
            }
        }
        
        // 기본 메뉴 데이터 반환
        function getDefaultMenuData() {
            return {
                "donut": [
                    { name: "GLAZED", description: "Our classic glazed donut with sweet icing", price: 0.99, imageUrl: "https://images.unsplash.com/photo-1551024506-0bccd828d307" },
                    { name: "CHOCOLATE", description: "Rich chocolate donut topped with chocolate icing", price: 1.09, imageUrl: "https://images.unsplash.com/photo-1527515545081-5db817172677" },
                    { name: "SPRINKLES", description: "Glazed donut covered with colorful sprinkles", price: 1.09, imageUrl: "https://images.unsplash.com/photo-1514517604298-cf80e0fb7f1e" },
                    { name: "TWIST", description: "Twisted dough with a light glaze coating", price: 1.79, imageUrl: "https://images.unsplash.com/photo-1551024709-8f23befc6f87" },
                    { name: "ECLAIR", description: "Chocolate topped long donut filled with custard", price: 1.99, imageUrl: "https://images.unsplash.com/photo-1551106652-a5bcf4b29ab6" }
                ],
                "cake-donut": [
                    { name: "PLAIN", description: "Traditional cake donut with dense, tender crumb", price: 1.39, imageUrl: "https://images.unsplash.com/photo-1551024506-0bccd828d307" },
                    { name: "BUTTERMILK", description: "Classic southern-style buttermilk cake donut", price: 1.59, imageUrl: "https://images.unsplash.com/photo-1526000771790-6eb5e8a3e93e" },
                    { name: "BLUEBERRY", description: "Cake donut filled with sweet blueberries", price: 1.59, imageUrl: "https://images.unsplash.com/photo-1557925923-cd4648e211a0" }
                ],
                "breakfast": [
                    { name: "SMALL SAUSAGE", description: "Savory sausage breakfast sandwich", price: 1.59, imageUrl: "https://images.unsplash.com/photo-1613844043867-52c37b60bc4d" },
                    { name: "JUMBO SAUSAGE", description: "Large sausage breakfast sandwich with egg", price: 2.99, imageUrl: "https://images.unsplash.com/photo-1529411081224-84ac0d0bf6ab" },
                    { name: "CROISSANT HAM & CHEESE", description: "Buttery croissant with ham and cheese", price: 3.99, imageUrl: "https://images.unsplash.com/photo-1639667951386-fb351e95953f" }
                ]
            };
        }

        // 주기적으로 메뉴 업데이트
        async function refreshMenu() {
            try {
                const menuData = await fetchMenuData();
                
                // 카테고리 순서 조정 - donut 카테고리를 맨 앞으로
                const orderedCategories = Object.keys(menuData);
                
                // donut 카테고리가 있으면 맨 앞으로 이동
                if (orderedCategories.includes('donut')) {
                    const donutIndex = orderedCategories.indexOf('donut');
                    orderedCategories.splice(donutIndex, 1); // donut 카테고리 제거
                    orderedCategories.unshift('donut'); // 맨 앞에 추가
                    
                    // 순서가 조정된 새 객체 생성
                    const orderedMenuData = {};
                    orderedCategories.forEach(category => {
                        orderedMenuData[category] = menuData[category];
                    });
                    
                    // 순서가 조정된 메뉴 데이터로 UI 업데이트
                    updateMenuUI(orderedMenuData);
                } else {
                    // donut 카테고리가 없으면 그대로 업데이트
                    updateMenuUI(menuData);
                }
                
                console.log('메뉴가 성공적으로 업데이트되었습니다.');
            } catch (error) {
                console.error('메뉴 업데이트 중 오류가 발생했습니다:', error);
                updateMenuUI(getDefaultMenuData());
            }
        }

        // 메뉴 데이터로 화면 업데이트
        function updateMenuUI(menuData) {
            if (!menuData) return; // 메뉴 데이터가 없으면 기존 메뉴 유지
            
            console.log('메뉴 데이터 업데이트:', Object.keys(menuData));
            
            // 동적 카테고리 탭 생성 또는 업데이트
            updateCategoryTabs(Object.keys(menuData));
            
            // 각 카테고리별 메뉴 업데이트
            Object.keys(menuData).forEach(category => {
                let categoryContainer = document.getElementById(category);
                
                // 해당 카테고리 컨테이너가 없으면 새로 생성
                if (!categoryContainer) {
                    // 메인 컨테이너 찾기
                    const mainContainer = document.querySelector('.container');
                    
                    // 새 카테고리 콘텐츠 컨테이너 생성
                    categoryContainer = document.createElement('div');
                    categoryContainer.id = category;
                    categoryContainer.className = 'menu-grid category-content';
                    
                    // 메인 컨테이너에 추가
                    mainContainer.appendChild(categoryContainer);
                    console.log(`새 카테고리 컨테이너 생성: ${category}`);
                }
                
                // 메뉴 아이템이 있으면 기존 내용 지우고 새로운 메뉴로 교체
                if (menuData[category] && menuData[category].length > 0) {
                    categoryContainer.innerHTML = '';
                    
                    menuData[category].forEach(item => {
                        // 이미지 URL 안전성 검증
                        let safeImageUrl = 'https://images.unsplash.com/photo-1551024506-0bccd828d307';
                        
                        if (item.imageUrl) {
                            // 구글 드라이브 URL 변환 시도
                            if (item.imageUrl.includes('drive.google.com/file/d/')) {
                                const convertedUrl = convertGoogleDriveUrl(item.imageUrl);
                                if (convertedUrl) {
                                    console.log('메뉴 렌더링 중 구글 드라이브 URL 변환:', item.imageUrl, ' -> ', convertedUrl);
                                    item.imageUrl = convertedUrl;
                                }
                            }
                            
                            try {
                                // URL이 올바른 형식인지 확인
                                new URL(item.imageUrl);
                                safeImageUrl = item.imageUrl;
                            } catch (e) {
                                console.warn('메뉴 렌더링 중 유효하지 않은 URL:', item.imageUrl);
                            }
                        }
                        
                        // 비건/논비건 표시 결정
                        // 메뉴 이름이나 설명에 고기, 고깃살, 육, 쇠고기, chicken, beef, pork, meat 등이 포함되어 있으면 논비건으로 표시
                        const isNonVeg = (item.name.toLowerCase().includes('chicken') || 
                                        item.name.toLowerCase().includes('beef') || 
                                        item.name.toLowerCase().includes('pork') || 
                                        item.name.toLowerCase().includes('meat') ||
                                        (item.description && (
                                            item.description.toLowerCase().includes('chicken') || 
                                            item.description.toLowerCase().includes('beef') || 
                                            item.description.toLowerCase().includes('pork') ||
                                            item.description.toLowerCase().includes('meat')
                                        )));
                        
                        console.log(`메뉴 아이템 렌더링: ${item.name}, 이미지 URL: ${safeImageUrl}`);
                        
                        // Updated HTML structure for horizontal layout with options modal trigger
                        const menuItemHtml = `
                            <div class="menu-item" onclick='showOptionsModal(${JSON.stringify(item)})'> 
                                <div class="menu-item-details">
                                    <h3>${item.name}</h3>
                                    <p>${item.description || '설명 없음'}</p>
                                    <div class="price-container">
                                        <div class="price">$${Number(item.price).toLocaleString()}</div> 
                                        <button class="add-to-cart" onclick="event.stopPropagation(); addToCart('${item.name}', ${item.price})">
                                            <span>Add to Cart</span>
                                        </button>
                                    </div>
                                </div>
                                <img src="${safeImageUrl}" 
                                     alt="${item.name}" 
                                     onerror="tryAlternativeImageUrl(this, '${item.imageUrl}');">
                            </div>
                        `;
                        categoryContainer.innerHTML += menuItemHtml;
                    });
                } else {
                    // 메뉴가 없는 경우 메시지 표시
                    categoryContainer.innerHTML = '<div class="no-items-message">No items available in this category</div>';
                }
            });
        }

        // 카테고리 탭 업데이트 함수
        function updateCategoryTabs(categories) {
            // 기존 탭 컨테이너 찾기
            const tabsContainer = document.querySelector('.category-tabs');
            if (!tabsContainer) return;
            
            // 현재 활성화된 탭 찾기
            let activeTabCategory = document.querySelector('.category-tab.active')?.getAttribute('data-category') || 'donut';
            
            // 처음 페이지 로드 시 'donut' 카테고리 기본 선택
            // 만약 'donut' 카테고리가 없으면 첫 번째 카테고리 선택
            if (!categories.includes(activeTabCategory)) {
                activeTabCategory = categories.includes('donut') ? 'donut' : categories[0];
            }
            
            // 기존 탭 모두 제거
            tabsContainer.innerHTML = '';
            
            // 새 탭 추가
            categories.forEach(category => {
                const tabBtn = document.createElement('button');
                tabBtn.className = 'category-tab';
                tabBtn.setAttribute('data-category', category);
                
                // 사용자에게 보여질 이름 (첫 글자만 대문자로)
                const displayName = category.charAt(0).toUpperCase() + category.slice(1);
                tabBtn.textContent = displayName;
                
                // 활성 탭 설정
                if (category === activeTabCategory) {
                    tabBtn.classList.add('active');
                }
                
                // 클릭 이벤트 리스너
                tabBtn.addEventListener('click', function() {
                    // 모든 탭에서 active 클래스 제거
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    
                    // 클릭한 탭에 active 클래스 추가
                    this.classList.add('active');
                    
                    // 모든 콘텐츠에서 active 클래스 제거 (모든 메뉴 숨김)
                    document.querySelectorAll('.category-content').forEach(content => content.classList.remove('active'));
                    
                    // 클릭한 탭에 해당하는 콘텐츠에만 active 클래스 추가 (해당 메뉴만 표시)
                    const categoryId = this.getAttribute('data-category');
                    document.getElementById(categoryId).classList.add('active');
                });
                
                tabsContainer.appendChild(tabBtn);
            });
            
            // 카테고리 콘텐츠 업데이트
            updateCategoryVisibility(activeTabCategory);
        }
        
        // 카테고리 표시 상태 업데이트
        function updateCategoryVisibility(activeCategory) {
            // 모든 카테고리 콘텐츠 숨기기
            document.querySelectorAll('.category-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 활성화된 카테고리만 표시
            const activeContent = document.getElementById(activeCategory);
            if (activeContent) {
                activeContent.classList.add('active');
            } else {
                // 활성화된 카테고리가 없으면 첫 번째 카테고리 활성화
                const firstContent = document.querySelector('.category-content');
                if (firstContent) {
                    firstContent.classList.add('active');
                }
            }
        }

        // DOM이 완전히 로드된 후 실행
        document.addEventListener('DOMContentLoaded', async function() {
            // 초기 로딩 표시
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.querySelector('.loading-content p').textContent = '메뉴 불러오는 중...';
            
            // 슬라이더 초기화
            showSlide(0);
            startSlideShow();
            
            // 사용자 로그인 상태 확인 및 UI 업데이트
            const userInfo = JSON.parse(localStorage.getItem('userInfo'));
            updateUserUI(userInfo);

            // 네비게이션 로그인 버튼 이벤트 리스너 추가
            // 로그인 상태에 따라 updateUserUI에서 onclick 핸들러가 설정되므로
            // 여기서 별도로 추가할 필요는 없지만, 초기 로그아웃 상태를 위해 명시적으로 추가할 수 있습니다.
            if (!userInfo || !userInfo.isLoggedIn) {
                document.querySelector('.login-btn').addEventListener('click', toggleLoginModal);
            }
            
            // 계정 탭 이벤트 리스너 추가
            const accountTabs = document.querySelectorAll('.account-tab');
            if (accountTabs) {
                accountTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // 활성 탭 변경
                        document.querySelectorAll('.account-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // 해당 콘텐츠 표시
                        const tabId = this.getAttribute('data-tab');
                        document.querySelectorAll('.account-tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.getElementById(tabId).classList.add('active');
                    });
                });
            }

            // 계정 탭 컨텐츠 스타일 추가
            if (!document.getElementById('accountTabsStyle')) {
                const style = document.createElement('style');
                style.id = 'accountTabsStyle';
                style.textContent = `
                    .account-tab {
                        position: relative;
                    }
                    
                    .account-tab.active button {
                        color: #0071e3;
                        font-weight: 500;
                    }
                    
                    .account-tab.active::after {
                        content: '';
                        position: absolute;
                        top: 0;
                        bottom: 0;
                        left: 0;
                        width: 3px;
                        background-color: #0071e3;
                    }
                    
                    .account-tab-content {
                        display: none;
                    }
                    
                    .account-tab-content.active {
                        display: block;
                    }
                `;
                document.head.appendChild(style);
            }
            
            // 페이지 깜박임 방지를 위해 초기 카테고리 구조 생성
            const mainContainer = document.querySelector('.container');
            const initialCategories = ['donut', 'cake-donut', 'breakfast'];
            
            initialCategories.forEach(category => {
                if (!document.getElementById(category)) {
                    const categoryContainer = document.createElement('div');
                    categoryContainer.id = category;
                    categoryContainer.className = 'menu-grid category-content';
                    
                    if (category === 'donut') {
                        categoryContainer.classList.add('active');
                    }
                    
                    mainContainer.appendChild(categoryContainer);
                }
            });
            
            // 초기 메뉴 로드
            await refreshMenu();
            
            // 주기적으로 메뉴 업데이트
            setInterval(refreshMenu, REFRESH_INTERVAL);
            
            // 이미지 로드 상태 모니터링
            setTimeout(() => {
                const allImages = document.querySelectorAll('.menu-item img');
                console.log(`총 ${allImages.length}개 이미지 로드 상태 확인 중...`);
                
                allImages.forEach((img, index) => {
                    if (!img.complete || img.naturalHeight === 0) {
                        console.warn(`이미지 ${index+1} 로드 실패:`, img.src);
                        
                        // 구글 드라이브 이미지 자동 재시도
                        const fileIdMatch = img.getAttribute('data-original-src')?.match(/\/d\/([^/]+)|\/id=([^&]+)/);
                        const fileId = fileIdMatch ? (fileIdMatch[1] || fileIdMatch[2]) : null;
                        
                        if (fileId) {
                            console.log('이미지 자동 재시도:', fileId);
                            
                            // 첫 번째 대체 방법 시도
                            img.src = `https://drive.google.com/uc?export=view&id=${fileId}`;
                            
                            // 두 번째 대체 방법도 실패하면 썸네일 시도
                            img.onerror = function() {
                                this.onerror = null;
                                this.src = `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`;
                                
                                // 마지막 실패 시 기본 이미지
                                this.onerror = function() {
                                    this.onerror = null;
                                    this.src = 'https://images.unsplash.com/photo-1551024506-0bccd828d307';
                                };
                            };
                        }
                    }
                });
            }, 3000); // 3초 후 이미지 상태 확인
        });

        // 장바구니 토글
        function toggleCart() {
            const cartModal = document.getElementById('cartModal');
            const isOpening = !cartModal.classList.contains('show');
            
            cartModal.classList.toggle('show');
            
            if (isOpening) {
                updateCartDisplay();
                document.body.classList.add('modal-open'); // body 스크롤 방지
                // 모달 외부 클릭 시 닫기 리스너 추가 (지연 추가)
                // setTimeout을 사용하여 모달이 완전히 열린 후 리스너 추가
                setTimeout(() => {
                    cartModal.addEventListener('click', closeCartOnOutsideClick);
                }, 0);
            } else {
                document.body.classList.remove('modal-open'); // body 스크롤 방지 해제
                // 모달 외부 클릭 시 닫기 리스너 제거
                cartModal.removeEventListener('click', closeCartOnOutsideClick);
            }
        }

        // 모달 외부 클릭 시 닫기 함수
        function closeCartOnOutsideClick(event) {
            // 클릭된 요소가 모달 배경(cartModal) 자체인지 확인
            // event.target은 실제 클릭된 요소를 가리키므로, id를 확인
            if (event.target.id === 'cartModal') { 
                toggleCart(); // 모달 닫기
            }
        }

        // 장바구니에 아이템 추가
        function addToCart(name, price) {
            // PICKUP이 활성화되지 않았으면 추가 불가
            if (!document.body.classList.contains('pickup-active')) {
                alert('Please select "PICKUP" from "ORDER ONLINE" first to add items to the cart.');
                return;
            }

            const existingItem = cart.find(item => item.name === name);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ name, price, quantity: 1 });
            }
            updateCartCount();
            updateCartDisplay();
            
            // 추가 성공 시각적 피드백
            // 1. 장바구니 아이콘 애니메이션
            const cartIcon = document.querySelector('.cart-icon');
            cartIcon.classList.add('add-success');
            setTimeout(() => {
                cartIcon.classList.remove('add-success');
            }, 500);
            
            // 2. 해당 버튼에 성공 피드백
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                const itemName = item.querySelector('h3').textContent;
                if (itemName === name) {
                    const addButton = item.querySelector('.add-to-cart');
                    const originalText = addButton.textContent;
                    addButton.textContent = 'Added';
                    addButton.style.backgroundColor = '#4CAF50';
                    
                    setTimeout(() => {
                        addButton.textContent = originalText;
                        addButton.style.backgroundColor = '';
                    }, 1000);
                }
            });
        }

        // 장바구니 카운트 업데이트
        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }

        // 장바구니 표시 업데이트
        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            cartItems.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart-message">
                        <i class="material-icons">shopping_cart</i>
                        <p>Your cart is empty</p>
                                    </div>
                `;
                cartTotal.textContent = '0';
                return;
            }

            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                cartItems.innerHTML += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">$${item.price.toLocaleString()} × ${item.quantity}</div>
                                </div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn" onclick="updateQuantity(${index}, -1)"><i class="material-icons">remove</i></button>
                            <span>${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity(${index}, 1)"><i class="material-icons">add</i></button>
                            <button class="quantity-btn" onclick="removeFromCart(${index})"><i class="material-icons">delete</i></button>
                        </div>
                    </div>
                `;
            });

            cartTotal.textContent = total.toLocaleString();
        }

        // 수량 업데이트
        function updateQuantity(index, change) {
            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            updateCartCount();
            updateCartDisplay();
        }

        // 장바구니에서 아이템 완전히 제거
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            updateCartDisplay();
        }

        // 주문 폼 표시 (수정됨)
        function showOrderForm() {
            // PICKUP이 활성화되지 않았거나 장바구니가 비었으면 진행 불가
            if (!document.body.classList.contains('pickup-active')) {
                 alert('Please select "PICKUP" from "ORDER ONLINE" first.');
                 return;
             }
            if (cart.length === 0) {
                alert('장바구니가 비어있습니다.');
                return;
            }

            // localStorage에서 픽업 시간 가져오기
            const pickupDateTimeString = localStorage.getItem('pickupDateTime');
            let displayTimeString = 'Not selected';
            if (pickupDateTimeString) {
                try {
                    const pickupInfo = JSON.parse(pickupDateTimeString);
                    const [year, month, day] = pickupInfo.date.split('-');
                    const [hour, minute] = pickupInfo.time.split(':');
                    const hour12 = parseInt(hour) % 12 === 0 ? 12 : parseInt(hour) % 12;
                    const ampm = parseInt(hour) < 12 ? 'AM' : 'PM';
                    displayTimeString = `${month.padStart(2, '0')}/${day.padStart(2, '0')}/${year} ${hour12}:${minute.padStart(2, '0')} ${ampm}`;
                } catch (e) {
                    console.error('Error parsing pickup time from localStorage:', e);
                    displayTimeString = 'Invalid time stored';
                }
            }
            document.getElementById('displayPickupTime').textContent = displayTimeString;

            document.getElementById('orderModal').classList.add('show');
        }

        // 주문 폼 닫기
        function closeOrderForm() {
            document.getElementById('orderModal').classList.remove('show');
        }

        // 주문 제출 (수정됨)
        function submitOrder(event) {
            event.preventDefault();

            // 필수 입력값 검증
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim(); // 주소는 Pickup 시 사용 안 함
            const deliveryOption = document.getElementById('deliveryOption').value;
            // const pickupTime = document.getElementById('pickupTime').value; // 이전 방식 제거

            // localStorage에서 픽업 시간 가져오기
            const pickupDateTimeString = localStorage.getItem('pickupDateTime');
            let pickupTimeCombined = 'N/A';
            if (pickupDateTimeString) {
                try {
                    const pickupInfo = JSON.parse(pickupDateTimeString);
                    pickupTimeCombined = `${pickupInfo.date} ${pickupInfo.time}`;
                } catch (e) {
                    console.error('Error reading pickup time for submission:', e);
                    alert('There was an error retrieving the selected pickup time. Please re-select the time.');
                    return;
                }
            } else {
                alert('Pickup time is missing. Please ensure you have selected a pickup time.');
                return;
            }

            if (!name || !phone) {
                alert('이름과 전화번호는 필수 입력 항목입니다.');
                return;
            }

            // Delivery Option이 pickup인지 확인 (Home Delivery는 현재 비활성화)
            if (deliveryOption !== 'pickup') {
                 alert('Currently, only Pickup is available.');
                return;
            }

            // 장바구니 아이템을 문자열로 변환
            const itemDetails = cart.map(item => 
                `${item.name} (${item.price}원 x ${item.quantity}개)`
            ).join('\n');

            // 총 주문 금액 계산
            const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            const orderData = {
                name: name,
                phone: phone,
                address: 'N/A (Pickup)', // Pickup이므로 주소 대신 표시
                deliveryOption: deliveryOption, // 'pickup'
                pickupTime: pickupTimeCombined, // 저장된 날짜/시간 사용
                items: cart.map(item => ({
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                itemDetails: itemDetails,
                total: totalAmount,
                notes: document.getElementById('notes').value.trim() // Special Instructions 추가
            };

            // 로딩 표시
            document.getElementById('loadingOverlay').style.display = 'flex';

            // 구글 시트에 데이터 전송
            fetch('https://script.google.com/macros/s/AKfycbzuIZT-pRiC4o53u0ruWefsfRqyDasNQqW7nOfs5ipHZ0PlicbFP3FixcjDZv4rha8QXQ/exec', {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(orderData),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(() => {
                // no-cors 모드에서는 응답을 받을 수 없으므로 바로 성공 처리
                alert('주문이 완료되었습니다! 감사합니다.');
                cart = [];
                updateCartCount();
                closeOrderForm();
                toggleCart();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('주문이 처리되었습니다. 감사합니다.');
                cart = [];
                updateCartCount();
                closeOrderForm();
                toggleCart();
            })
            .finally(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            });
        }

        // JSONP로 데이터 가져오기
        function fetchMenuDataJSONP() {
            return new Promise((resolve, reject) => {
                // 콜백 함수 이름 생성
                const callbackName = 'jsonpCallback_' + Math.round(Math.random() * 10000);
                
                // 타임아웃 설정 (5초)
                const timeoutId = setTimeout(() => {
                    reject(new Error('JSONP 요청 타임아웃'));
                    cleanup();
                }, 5000);
                
                function cleanup() {
                    // 스크립트 태그가 있으면 제거
                    if (script && script.parentNode) {
                        document.body.removeChild(script);
                    }
                    // 글로벌 콜백 함수 삭제
                    delete window[callbackName];
                    // 타임아웃 제거
                    clearTimeout(timeoutId);
                }
                
                // 글로벌 스코프에 콜백 함수 정의
                window[callbackName] = function(data) {
                    cleanup();
                    // 데이터 반환
                    resolve(data);
                };
                
                // 스크립트 태그 생성
                const script = document.createElement('script');
                script.src = `${API_URL}?action=getMenu&callback=${callbackName}`;
                
                // 에러 처리
                script.onerror = function() {
                    cleanup();
                    // reject 대신 정보 메시지를 콘솔에 기록하고 특별한 값으로 resolve
                    console.info('JSONP 요청을 사용할 수 없습니다. 대체 방법으로 전환합니다.');
                    resolve({ _jsonpError: true });
                };
                
                // 스크립트 태그를 body에 추가하면 자동으로 로드됨
                document.body.appendChild(script);
            });
        }
        
        // 직접 이미지 URL에 접근하여 메뉴 데이터 구성하기
        async function fetchDirectImageUrls() {
            try {
                // 카테고리 이름과 메뉴 이름도 함께 가져오기
                const menuResponse = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=메뉴 목록`);
                const menuCsvText = await menuResponse.text();
                
                // CSV 파싱을 간소화하면서 큰따옴표 처리에 주의
                const rows = menuCsvText.split('\n');
                const menuLines = [];
                
                for (let row of rows) {
                    // 빈 줄 무시
                    if (!row.trim()) continue;
                    
                    const fields = [];
                    let inQuote = false;
                    let field = '';
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        
                        if (char === '"') {
                            inQuote = !inQuote;
                        } else if (char === ',' && !inQuote) {
                            fields.push(field.replace(/^"|"$/g, ''));
                            field = '';
                        } else {
                            field += char;
                        }
                    }
                    
                    fields.push(field.replace(/^"|"$/g, ''));
                    menuLines.push(fields);
                }
                
                // 헤더 행 처리
                const headers = menuLines[0].map(header => header.toLowerCase().trim());
                
                const categoryIndex = headers.indexOf('category');
                const nameIndex = headers.indexOf('name');
                const descriptionIndex = headers.indexOf('description');
                const priceIndex = headers.indexOf('price');
                const imageUrlIndex = headers.indexOf('imageurl');
                
                if (categoryIndex === -1 || nameIndex === -1 || priceIndex === -1) {
                    throw new Error('필수 열(category, name, price)이 없습니다.');
                }
                
                // 카테고리 구조 생성
                const menuData = {};
                const categories = new Set();
                
                // 카테고리 수집
                for (let i = 1; i < menuLines.length; i++) {
                    const row = menuLines[i];
                    if (row.length <= categoryIndex) continue;
                    
                    const category = row[categoryIndex]?.trim();
                    if (category) {
                        categories.add(category);
                    }
                }
                
                // 카테고리별 빈 배열 생성
                categories.forEach(category => {
                    menuData[category] = [];
                });
                
                // 기본 메뉴 데이터 구성
                for (let i = 1; i < menuLines.length; i++) {
                    const row = menuLines[i];
                    if (row.length <= categoryIndex) continue;
                    
                    const category = row[categoryIndex]?.trim();
                    const name = row[nameIndex]?.trim();
                    const price = parseFloat(row[priceIndex]);
                    
                    if (!category || !name || isNaN(price)) continue;
                    
                    const menuItem = {
                        name: name,
                        price: price,
                        description: descriptionIndex !== -1 && row.length > descriptionIndex ? row[descriptionIndex]?.trim() || '' : '',
                        imageUrl: 'https://images.unsplash.com/photo-1551024506-0bccd828d307' // 기본 이미지로 초기화
                    };
                    
                    if (menuData[category]) {
                        menuData[category].push(menuItem);
                    }
                }
                
                // 이제 이미지 URL 업데이트
                if (imageUrlIndex !== -1) {
                    for (let i = 1; i < menuLines.length; i++) {
                        const row = menuLines[i];
                        if (row.length <= imageUrlIndex) continue;
                        
                        const category = row[categoryIndex]?.trim();
                        const name = row[nameIndex]?.trim();
                        const imageUrl = row[imageUrlIndex]?.trim();
                        
                        if (!category || !name || !imageUrl) continue;
                        
                        // 해당 메뉴 아이템 찾기
                        const categoryItems = menuData[category];
                        if (categoryItems) {
                            const menuItem = categoryItems.find(item => item.name === name);
                            if (menuItem) {
                                // 구글 드라이브 URL 변환 시도
                                if (imageUrl.includes('drive.google.com/file/d/')) {
                                    const convertedUrl = convertGoogleDriveUrl(imageUrl);
                                    if (convertedUrl) {
                                        console.log('직접 URL 접근: 구글 드라이브 URL 변환:', imageUrl, ' -> ', convertedUrl);
                                        menuItem.imageUrl = convertedUrl;
                                    } else {
                                        menuItem.imageUrl = imageUrl;
                                    }
                                } else {
                                    menuItem.imageUrl = imageUrl;
                                }
                            }
                        }
                    }
                }
                
                console.log('직접 접근으로 생성된 메뉴 데이터:', Object.keys(menuData));
                return menuData;
            } catch (error) {
                console.error('직접 이미지 URL 가져오기 실패:', error);
                return null;
            }
        }

        // 구글 드라이브 URL을 직접 이미지 URL로 변환
        function convertGoogleDriveUrl(driveUrl) {
            try {
                // 구글 드라이브 URL 패턴 확인
                if (!driveUrl || typeof driveUrl !== 'string') return null;
                
                // 파일 ID 추출 패턴: https://drive.google.com/file/d/FILE_ID/view
                const fileIdMatch = driveUrl.match(/\/file\/d\/([^\/]+)/);
                if (!fileIdMatch || !fileIdMatch[1]) return null;
                
                const fileId = fileIdMatch[1];
                console.log('변환된 구글 드라이브 파일 ID:', fileId);
                
                // 여러 방법을 시도하고, 이미지 로드 실패 시 다른 방법 사용
                
                // 방법 1: googleusercontent 직접 링크 형식
                return `https://lh3.googleusercontent.com/d/${fileId}`;
                
                // 방법 2: 공개 권한 있는 파일용 uc 링크
                // return `https://drive.google.com/uc?export=view&id=${fileId}`;
                
                // 방법 3: 구글 드라이브 썸네일 API (작은 이미지)
                // return `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`;
                
                // 방법 4: 구글 드라이브 미리보기 (iframe 안에서만 작동)
                // return `https://drive.google.com/file/d/${fileId}/preview`;
            } catch (error) {
                console.error('구글 드라이브 URL 변환 실패:', error);
                return null;
            }
        }
        
        // 실패한 이미지를 다른 방식으로 로드 시도하는 함수
        function tryAlternativeImageUrl(img, fileId) {
            // 이미 기본 이미지로 대체되었으면 더 이상 시도하지 않음
            if (img.src.includes('unsplash.com')) return;
            
            // 방법 2 시도
            if (!img.src.includes('uc?export=view')) {
                img.src = `https://drive.google.com/uc?export=view&id=${fileId}`;
                return;
            }
            
            // 방법 3 시도
            if (!img.src.includes('thumbnail')) {
                img.src = `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`;
                return;
            }
            
            // 모든 방법 실패 시 기본 이미지
            img.src = 'https://images.unsplash.com/photo-1551024506-0bccd828d307';
        }

        // 주문 선택 모달 표시
        function showOrderChoiceModal() {
            document.getElementById('orderChoiceModal').classList.add('show');
        }

        // 주문 선택 모달 닫기
        function closeOrderChoiceModal() {
            document.getElementById('orderChoiceModal').classList.remove('show');
        }

        // Pickup Time 선택 모달 표시
        function showPickupTimeModal() {
            const dateInput = document.getElementById('pickupDate');
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();

            // 픽업 마감 시간 (11:30 AM)
            const cutoffHour = 11;
            const cutoffMinute = 30;

            let minDate = new Date(); // 기본값: 오늘

            // 현재 시간이 11:30 AM 이후인지 확인
            if (currentHour > cutoffHour || (currentHour === cutoffHour && currentMinute >= cutoffMinute)) {
                // 11:30 AM 이후면, 최소 선택 가능 날짜를 내일로 설정
                minDate.setDate(minDate.getDate() + 1);
                console.log('Current time is past 11:30 AM. Minimum pickup date set to tomorrow.');
            }

            const minDateString = minDate.toISOString().split('T')[0];
            dateInput.min = minDateString; // 최소 날짜 설정
            dateInput.value = minDateString; // 기본 선택 날짜 설정

            // 시간 드롭다운 채우기
            populateTimeDropdown();

            // 숨겨진 input 초기화 및 트리거 텍스트 초기화
            document.getElementById('pickupTimeHidden').value = '';
            document.getElementById('selectedTimeText').textContent = 'Select a time';
            document.getElementById('timeSelectTrigger').classList.remove('open');
            document.getElementById('timeDropdown').classList.remove('show');

            document.getElementById('pickupTimeModal').classList.add('show');

            // 드롭다운 외부 클릭 시 닫기 이벤트 리스너 추가
            document.addEventListener('click', closeDropdownOnClickOutside);
        }

        // Pickup Time 선택 모달 닫기
        function closePickupTimeModal() {
            document.getElementById('pickupTimeModal').classList.remove('show');
            // 이벤트 리스너 제거
            document.removeEventListener('click', closeDropdownOnClickOutside);
        }

        // 시간 슬롯 생성 함수
        function generateTimeSlots(startHour, startMinute, endHour, endMinute, intervalMinutes) {
            const slots = [];
            let currentHour = startHour;
            let currentMinute = startMinute;

            while (currentHour < endHour || (currentHour === endHour && currentMinute <= endMinute)) {
                const hour12 = currentHour % 12 === 0 ? 12 : currentHour % 12;
                const ampm = currentHour < 12 ? 'AM' : 'PM';
                const formattedTime = `${hour12}:${currentMinute.toString().padStart(2, '0')} ${ampm} CDT`;
                const valueTime = `${currentHour.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;
                slots.push({ display: formattedTime, value: valueTime });

                currentMinute += intervalMinutes;
                if (currentMinute >= 60) {
                    currentHour += Math.floor(currentMinute / 60);
                    currentMinute %= 60;
                }
            }
            return slots;
        }

        // 시간 드롭다운 채우기 함수
        function populateTimeDropdown() {
            const dropdown = document.getElementById('timeDropdown');
            dropdown.innerHTML = ''; // 기존 옵션 제거
            const timeSlots = generateTimeSlots(5, 30, 11, 30, 15); // 5:30 AM to 11:30 AM, 15 min interval

            timeSlots.forEach(slot => {
                const option = document.createElement('div');
                option.classList.add('time-option');
                option.textContent = slot.display;
                option.dataset.value = slot.value;
                option.onclick = () => selectTime(slot.display, slot.value);
                dropdown.appendChild(option);
            });
        }

        // 시간 드롭다운 토글 함수
        function toggleTimeDropdown(event) {
            event.stopPropagation(); // 이벤트 버블링 방지
            const dropdown = document.getElementById('timeDropdown');
            const trigger = document.getElementById('timeSelectTrigger');
            dropdown.classList.toggle('show');
            trigger.classList.toggle('open');
        }

        // 시간 선택 함수
        function selectTime(displayTime, valueTime) {
            document.getElementById('selectedTimeText').textContent = displayTime;
            document.getElementById('pickupTimeHidden').value = valueTime;
            document.getElementById('timeDropdown').classList.remove('show');
            document.getElementById('timeSelectTrigger').classList.remove('open');

            // 선택된 옵션에 selected 클래스 추가 (선택 사항)
            document.querySelectorAll('.time-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.value === valueTime) {
                    opt.classList.add('selected');
                }
            });
        }

        // 드롭다운 외부 클릭 시 닫기
        function closeDropdownOnClickOutside(event) {
            const dropdown = document.getElementById('timeDropdown');
            const trigger = document.getElementById('timeSelectTrigger');
            if (dropdown && trigger && !trigger.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
                trigger.classList.remove('open');
                document.removeEventListener('click', closeDropdownOnClickOutside);
            }
        }

        // Pickup Time 확인 및 진행 (수정됨)
        function confirmPickupTime() {
            const selectedDate = document.getElementById('pickupDate').value;
            const selectedTime = document.getElementById('pickupTimeHidden').value; // 숨겨진 input에서 값 가져오기

            if (!selectedDate || !selectedTime) {
                alert('Please select both a date and time for pickup.');
                return;
            }

            // 선택된 시간 유효성 검사 (5:30 AM - 11:30 AM) - 숨겨진 input 값 사용
            const minTime = '05:30';
            const maxTime = '11:30';
            if (selectedTime < minTime || selectedTime > maxTime) {
                // 이 경고는 이론적으로 발생하면 안 되지만, 안전장치로 둠
                alert('Invalid time selected. Please select a time between 5:30 AM and 11:30 AM.');
                return;
            }

            // 선택된 날짜/시간 저장 (예: 전역 변수나 localStorage)
            localStorage.setItem('pickupDateTime', JSON.stringify({ date: selectedDate, time: selectedTime }));
            const selectedTimeDisplay = document.getElementById('selectedTimeText').textContent;
            console.log(`Pickup scheduled for: ${selectedDate} at ${selectedTimeDisplay} (${selectedTime})`);

            closePickupTimeModal();
            document.body.classList.add('pickup-active'); // body에 클래스 추가
            isPickupActive = true;
            scrollToMenu(); // 메뉴 섹션으로 스크롤
            console.log('Pickup time confirmed. Cart enabled.');
        }

        // PICKUP 선택 처리 (수정됨)
        function selectPickup() {
            closeOrderChoiceModal();
            showPickupTimeModal(); // Pickup Time 모달 표시
            // document.body.classList.add('pickup-active'); // 이 부분은 confirmPickupTime에서 처리
            // isPickupActive = true;
            // scrollToMenu(); // 이 부분은 confirmPickupTime에서 처리
            // console.log('PICKUP selected. Showing time selection modal.');
        }

        // DOORDASH 선택 처리
        function selectDoorDash() {
            closeOrderChoiceModal();
            const doordashUrl = 'https://order.online/store/texan-lee-donuts-lewisville-30922645/?hideModal=true&pickup=true&rwg_token=AAiGsoa6O9lQlKQRmJ3mIWwCH8qeDLIQvQt4DW6yJieLHT8H-5xnMBQkmMjxgD3ck0-Iao1dK7Yy0CygTFXH245QQUDjxdO9gw==&utm_source=gfo';
            window.open(doordashUrl, '_blank'); // 새 탭에서 열기
            console.log('Redirecting to DoorDash:', doordashUrl);
        }

        // Checkout 모달 표시 (기존 showOrderForm 이름 변경 및 수정)
        function showCheckoutModal() {
            // PICKUP이 활성화되지 않았거나 장바구니가 비었으면 진행 불가
            if (!document.body.classList.contains('pickup-active')) {
                 alert('Please select "PICKUP" from "ORDER ONLINE" first.');
                 return;
             }
            if (cart.length === 0) {
                alert('장바구니가 비어있습니다.');
                return;
            }

            // --- Checkout 모달 내용 업데이트 --- 

            // 1. 픽업 시간 표시
            const pickupDateTimeString = localStorage.getItem('pickupDateTime');
            let displayTimeString = 'ASAP (Est. 15-20 minutes)'; // 기본값 또는 시간 미선택 시
            if (pickupDateTimeString) {
                try {
                    const pickupInfo = JSON.parse(pickupDateTimeString);
                    const [year, month, day] = pickupInfo.date.split('-');
                    const [hour, minute] = pickupInfo.time.split(':');
                    const hour12 = parseInt(hour) % 12 === 0 ? 12 : parseInt(hour) % 12;
                    const ampm = parseInt(hour) < 12 ? 'AM' : 'PM';
                    displayTimeString = `${month.padStart(2, '0')}/${day.padStart(2, '0')}/${year} ${hour12}:${minute.padStart(2, '0')} ${ampm}`; 
                } catch (e) {
                    console.error('Error parsing pickup time for checkout modal:', e);
                    displayTimeString = 'Invalid time stored';
                }
            }
            document.getElementById('checkoutPickupTime').textContent = displayTimeString;

            // 2. 주문 상세 (아이템 목록)
            const orderItemsContainer = document.getElementById('checkoutOrderItems');
            orderItemsContainer.innerHTML = ''; // 기존 내용 초기화
            let subtotal = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                orderItemsContainer.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; font-size: 0.9rem;">
                        <div>
                            <span style="font-weight: 500;">${item.name}</span>
                            <span style="color: #6e6e73; margin-left: 0.5rem;">x ${item.quantity}</span>
                        </div>
                        <span>$${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            });
            document.getElementById('checkoutItemCount').textContent = cart.length;
            // 초기에는 상세 내역 숨김 상태로 설정
            orderItemsContainer.style.display = 'none';
            document.getElementById('orderDetailsToggleIcon').textContent = 'expand_more';

            // 3. 가격 요약 계산 및 표시
            const TAX_RATE = 0.0825; // 8.25% 세금 (예시, 필요시 수정)
            const tax = subtotal * TAX_RATE;
            const total = subtotal + tax;
            
            document.getElementById('checkoutTaxRate').textContent = (TAX_RATE * 100).toFixed(2); // 세율 표시
            document.getElementById('checkoutSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('checkoutTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('checkoutTotal').textContent = `$${total.toFixed(2)}`;

            // 4. 모달 표시
            document.getElementById('checkoutModal').classList.add('show');
            // 지도 레이아웃 보정 제거
            // ensureMapLayout(map);
        }

        // Checkout 모달 닫기
        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('show');
        }

        // 주문 상세 펼치기/접기
        function toggleOrderDetails() {
            const itemsContainer = document.getElementById('checkoutOrderItems');
            const toggleIcon = document.getElementById('orderDetailsToggleIcon');
            const isHidden = itemsContainer.style.display === 'none';
            itemsContainer.style.display = isHidden ? 'block' : 'none';
            toggleIcon.textContent = isHidden ? 'expand_less' : 'expand_more';
        }

        // Pickup 시간 수정 (Edit 버튼 클릭 시)
        function editPickupTime(event) {
            event.preventDefault();
            closeCheckoutModal(); // Checkout 모달 닫기
            showPickupTimeModal(); // Pickup 시간 선택 모달 열기
        }

        // 주문 폼 닫기 (이전 Order Information 모달용 함수, 이름 유지)
        function closeOrderForm() {
            document.getElementById('orderModal').classList.remove('show');
        }

        // 주문 제출 (수정됨 - Checkout 모달 컨텍스트 반영)
        function submitOrder(event) {
            event.preventDefault();

            // localStorage에서 픽업 시간 가져오기
            const pickupDateTimeString = localStorage.getItem('pickupDateTime');
            let pickupTimeCombined = 'N/A';
            if (pickupDateTimeString) {
                try {
                    const pickupInfo = JSON.parse(pickupDateTimeString);
                    pickupTimeCombined = `${pickupInfo.date} ${pickupInfo.time}`;
                } catch (e) {
                    console.error('Error reading pickup time for submission:', e);
                    alert('There was an error retrieving the selected pickup time. Please re-select the time.');
                    return;
                }
            } else {
                 alert('Pickup time is missing. Please ensure you have selected a pickup time.');
                return;
            }

            // 필수 입력값 가져오기 (Checkout 모달 컨텍스트)
            const userInfo = JSON.parse(localStorage.getItem('userInfo'));
            const name = userInfo ? userInfo.name : 'Guest User'; // 로그인 정보 활용
            const phone = userInfo ? userInfo.phone : 'N/A'; // 로그인 정보 활용 (전화번호가 저장되어 있다면)
             // 실제 앱에서는 이름/전화번호를 Checkout 모달에서 받거나, 로그인 정보를 필수로 요구해야 함
            if (name === 'Guest User' || phone === 'N/A') {
                 // 임시로 이전 Order Information 모달을 열어 정보 입력 유도
                 alert('Please provide your name and phone number.');
                 closeCheckoutModal();
                 document.getElementById('orderModal').classList.add('show'); 
                 // Order Information 모달에도 픽업 시간 표시 업데이트
                 document.getElementById('displayPickupTime').textContent = document.getElementById('checkoutPickupTime').textContent;
                 return;
             }

            const deliveryOption = 'pickup'; // Checkout 경로는 무조건 pickup

            // 장바구니 아이템을 문자열로 변환
            const itemDetails = cart.map(item => 
                `${item.name} (${item.price}원 x ${item.quantity}개)`
            ).join('\n');

            // 총 주문 금액 재계산 (submitOrder에서 다시 계산)
            const TAX_RATE = 0.0825;
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalAmount = subtotal * (1 + TAX_RATE);

            const orderData = {
                name: name,
                phone: phone,
                address: 'N/A (Pickup)',
                deliveryOption: deliveryOption,
                pickupTime: pickupTimeCombined,
                items: cart.map(item => ({
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                itemDetails: itemDetails,
                total: totalAmount,
                 notes: '' // Checkout 모달에 notes 필드 없으므로 빈 값
            };

            // 로딩 표시
            document.getElementById('loadingOverlay').style.display = 'flex';

            // 구글 시트에 데이터 전송
            fetch('https://script.google.com/macros/s/AKfycbzuIZT-pRiC4o53u0ruWefsfRqyDasNQqW7nOfs5ipHZ0PlicbFP3FixcjDZv4rha8QXQ/exec', { 
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(orderData),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(() => {
                alert('주문이 완료되었습니다! 감사합니다.');
                cart = [];
                updateCartCount();
                closeCheckoutModal(); // Checkout 모달 닫기
                document.body.classList.remove('pickup-active'); // Pickup 상태 해제
                 localStorage.removeItem('pickupDateTime'); // 저장된 픽업 시간 제거
            })
            .catch(error => {
                console.error('Error submitting order:', error);
                alert('주문 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
            })
            .finally(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            });
        }

        // Checkout 모달에서 Payment 단계로 진행
        function proceedToPayment(event) {
            event.preventDefault();
            // 가격 정보 저장 (checkoutModal에서 계산된 값 사용)
            const pricing = {
                subtotal: document.getElementById('checkoutSubtotal').textContent,
                tax: document.getElementById('checkoutTax').textContent,
                total: document.getElementById('checkoutTotal').textContent
            };
            localStorage.setItem('orderPricing', JSON.stringify(pricing));

            closeCheckoutModal();
            // Order Information 모달(결제 단계) 열기 및 정보 채우기
            showPaymentModal(); 
        }

        // Payment 모달 표시 및 정보 채우기
        function showPaymentModal() {
            // 저장된 가격 정보 가져오기
            const pricingString = localStorage.getItem('orderPricing');
            if (pricingString) {
                try {
                    const pricing = JSON.parse(pricingString);
                    document.getElementById('paymentSubtotal').textContent = pricing.subtotal;
                    document.getElementById('paymentTax').textContent = pricing.tax;
                    document.getElementById('paymentTotal').textContent = pricing.total;
                } catch (e) {
                    console.error('Error parsing pricing from localStorage:', e);
                    document.getElementById('paymentSubtotal').textContent = '$?.??';
                    document.getElementById('paymentTax').textContent = '$?.??';
                    document.getElementById('paymentTotal').textContent = '$?.??';
                }
            }

            // 사용자 정보 미리 채우기 (localStorage 활용)
            const userInfo = JSON.parse(localStorage.getItem('userInfo'));
            if (userInfo) {
                document.getElementById('name').value = userInfo.name || '';
                document.getElementById('phone').value = userInfo.phone || '';
                document.getElementById('orderEmail').value = userInfo.email || ''; // 이메일 채우기 추가
            }

            // 모달 표시
            document.getElementById('orderModal').classList.add('show');
        }

        // 주문 폼 닫기 (Payment 모달용)
        function closeOrderForm() {
            document.getElementById('orderModal').classList.remove('show');
        }

        // 최종 주문 제출 (기존 submitOrder 이름 변경 및 수정)
        function submitFinalOrder(event) {
            event.preventDefault();

            // localStorage에서 픽업 시간 가져오기
            const pickupDateTimeString = localStorage.getItem('pickupDateTime');
            let pickupTimeCombined = 'N/A';
            if (pickupDateTimeString) {
                try {
                    const pickupInfo = JSON.parse(pickupDateTimeString);
                    pickupTimeCombined = `${pickupInfo.date} ${pickupInfo.time}`;
                } catch (e) {
                    console.error('Error reading pickup time for submission:', e);
                    alert('There was an error retrieving the selected pickup time. Please go back and re-select.');
                    return;
                }
            } else {
                 alert('Pickup time is missing. Please ensure you have selected a pickup time.');
                return;
            }

            // Payment 모달에서 사용자 정보 가져오기
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('orderEmail').value.trim();

            if (!name || !phone || !email) {
                 alert('Please fill in your Name, Phone Number, and Email Address.');
                 return;
             }
             // 간단한 이메일 형식 검사
             if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                 alert('Please enter a valid Email Address.');
                 return;
             }

            const deliveryOption = 'pickup'; // 이 단계는 무조건 pickup

            // 장바구니 아이템을 문자열로 변환
            const itemDetails = cart.map(item => 
                `${item.name} (${item.price}원 x ${item.quantity}개)`
            ).join('\n');

            // 저장된 가격 정보 가져오기 (또는 다시 계산)
            const pricingString = localStorage.getItem('orderPricing');
            let totalAmount = 0;
            if(pricingString) {
                 try {
                     const pricing = JSON.parse(pricingString);
                     // $ 기호 제거하고 숫자로 변환
                     totalAmount = parseFloat(pricing.total.replace('$', '')); 
                 } catch(e) {
                     console.error("Error parsing total price for submission");
                     // 안전하게 다시 계산
                     const TAX_RATE = 0.0825;
                     const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                     totalAmount = subtotal * (1 + TAX_RATE);
                 }
            } else {
                 // 가격 정보 없으면 다시 계산
                 const TAX_RATE = 0.0825;
                 const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                 totalAmount = subtotal * (1 + TAX_RATE);
            }

            const orderData = {
                name: name,
                phone: phone,
                email: email, // 이메일 추가
                address: 'N/A (Pickup)',
                deliveryOption: deliveryOption,
                pickupTime: pickupTimeCombined,
                items: cart.map(item => ({
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                itemDetails: itemDetails,
                total: totalAmount,
                 notes: document.getElementById('notes').value.trim() // Special Instructions 가져오기
            };

            // 로딩 표시
            document.getElementById('loadingOverlay').style.display = 'flex';

            // 구글 시트에 데이터 전송
            fetch('https://script.google.com/macros/s/AKfycbzuIZT-pRiC4o53u0ruWefsfRqyDasNQqW7nOfs5ipHZ0PlicbFP3FixcjDZv4rha8QXQ/exec', { 
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(orderData),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(() => {
                alert('Order placed successfully! Thank you.');
                cart = [];
                updateCartCount();
                closeOrderForm(); // Payment 모달 닫기
                document.body.classList.remove('pickup-active'); // Pickup 상태 해제
                 localStorage.removeItem('pickupDateTime'); // 저장된 픽업 시간 제거
                 localStorage.removeItem('orderPricing'); // 저장된 가격 정보 제거
            })
            .catch(error => {
                console.error('Error submitting final order:', error);
                alert('There was an error placing your order. Please try again.');
            })
            .finally(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            });
        }

        // --- Options Modal Logic --- 
        let currentOptionsItem = null;
        let currentOptionsQuantity = 1;
        let selectedOptionPriceModifier = 0;
        let itemToAddAfterPickupSelection = null; // Variable to hold item details temporarily

        function showOptionsModal(item) {
            currentOptionsItem = item;
            currentOptionsQuantity = 1;
            selectedOptionPriceModifier = 0; // Reset selected option
            console.log("Showing options for:", item);

            // 먼저 이전에 생성된 ECLAIR 관련 옵션 그룹들 제거
            const optionsDetailsDiv = document.querySelector('.options-details');
            if (optionsDetailsDiv) {
                // 아이싱과 필링 옵션 그룹들 찾기
                const allOptionGroups = optionsDetailsDiv.querySelectorAll('.options-group');
                allOptionGroups.forEach(group => {
                    // 기본 옵션 그룹(id가 optionsSelectionGroup인 것)은 유지
                    if (group.id !== 'optionsSelectionGroup') {
                        group.remove();
                    }
                });
            }

            const modal = document.getElementById('optionsModal');
            document.getElementById('optionsImage').src = item.imageUrl || 'https://images.unsplash.com/photo-1551024506-0bccd828d307';
            document.getElementById('optionsTitle').textContent = item.name;
            document.getElementById('optionsQuantity').textContent = currentOptionsQuantity;

            // --- Option Generation Logic --- 
            const optionsChoicesDiv = document.getElementById('optionsChoices');
            const optionsGroupLabel = document.getElementById('optionsGroupLabel');
            const optionsSelectionGroup = document.getElementById('optionsSelectionGroup');
            optionsChoicesDiv.innerHTML = ''; // Clear previous options
            selectedOptionPriceModifier = 0; // Reset modifier

            const itemNameLower = item.name.toLowerCase();

            // Example: Options for "Glazed Donut Holes"
            if (itemNameLower.includes('glazed donut holes')) {
                optionsSelectionGroup.style.display = 'block';
                optionsGroupLabel.textContent = 'Glazed Donut Holes Count';

                const options = [
                    { label: '6 count', priceModifier: 1.75 },
                    { label: '12 count', priceModifier: 3.50 }
                ];

                options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-choice';
                    button.dataset.priceModifier = option.priceModifier;
                    button.innerHTML = `
                        <span>${option.label}</span>
                        <span>+$${option.priceModifier.toFixed(2)}</span>
                    `;
                    button.onclick = () => selectOption(button, option.priceModifier);
                    optionsChoicesDiv.appendChild(button);
                    
                    // Automatically select the first option initially
                    if (index === 0) {
                        selectOption(button, option.priceModifier);
                    }
                });
            } 
            // NEW: Options for "Glazed" or "Chocolate" donuts
            else if (itemNameLower.includes('glazed') || itemNameLower.includes('chocolate')) {
                optionsSelectionGroup.style.display = 'block';
                optionsGroupLabel.textContent = 'Select Quantity'; // Or your preferred label

                const dozenPrice = 10.00; // Assumed price for a dozen

                const options = [
                    { label: 'Single', priceModifier: item.price }, // Single price is item's base price
                    { label: 'Dozen', priceModifier: dozenPrice }     // Dozen price
                ];

                options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-choice';
                    // Store the price for this specific option quantity (single or dozen)
                    button.dataset.priceModifier = option.priceModifier; 
                    button.innerHTML = `
                        <span>${option.label}</span>
                        <span>$${option.priceModifier.toFixed(2)}</span> 
                    `;
                    button.onclick = () => selectOption(button, option.priceModifier);
                    optionsChoicesDiv.appendChild(button);

                    // Automatically select the first option ("Single") initially
                    if (index === 0) {
                        selectOption(button, option.priceModifier);
                    }
                });
            }
            // NEW: Options for SPRINKLES
            else if (itemNameLower.includes('sprinkles')) {
                optionsSelectionGroup.style.display = 'block';
                optionsGroupLabel.textContent = 'Select Icing';
                document.querySelector('#optionsSelectionGroup .options-select-prompt').textContent = 'Please select 1'; // Ensure prompt is correct

                const options = [
                    { label: 'Strawberry Icing' },
                    { label: 'Vanilla Icing' },
                    { label: 'Chocolate Icing' }
                ];

                options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-choice';
                    button.dataset.priceModifier = item.price; // Price doesn't change with icing
                    button.innerHTML = `<span>${option.label}</span>`; // Only show label
                    button.onclick = () => selectOption(button, item.price);
                    optionsChoicesDiv.appendChild(button);

                    if (index === 0) {
                        selectOption(button, item.price);
                    }
                });
            }
            // NEW: Options for TWIST
            else if (itemNameLower.includes('twist')) {
                optionsSelectionGroup.style.display = 'block';
                optionsGroupLabel.textContent = 'Select Flavor';
                 document.querySelector('#optionsSelectionGroup .options-select-prompt').textContent = 'Please select 1';

                const options = [
                    { label: 'Strawberry Icing' },
                    { label: 'Chocolate Icing' },
                    { label: 'Cinnamon Glazed' },
                    { label: 'Glazed' },
                    { label: 'Cinnamon Sugar' }
                ];

                options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-choice';
                    button.dataset.priceModifier = item.price; // Price doesn't change with flavor
                    button.innerHTML = `<span>${option.label}</span>`;
                    button.onclick = () => selectOption(button, item.price);
                    optionsChoicesDiv.appendChild(button);

                    if (index === 0) {
                        selectOption(button, item.price);
                    }
                });
            }
            // NEW: Options for ECLAIR
            else if (itemNameLower.includes('eclair')) {
                optionsSelectionGroup.style.display = 'block'; // Keep this block visible

                // --- ICING Options ---
                const icingGroupDiv = document.createElement('div');
                icingGroupDiv.className = 'options-group';
                icingGroupDiv.innerHTML = `
                    <label class="options-group-label">Select Icing</label>
                    <span class="options-required">Required*</span>
                    <p class="options-select-prompt">Please select 1</p>
                    <div class="options-choices icing-choices"></div>
                `;
                optionsDetailsDiv.insertBefore(icingGroupDiv, optionsDetailsDiv.querySelector('.options-footer')); // Insert before footer

                const icingChoicesDiv = icingGroupDiv.querySelector('.icing-choices');
                const icingOptions = [
                    { label: 'Chocolate Icing' },
                    { label: 'Glazed' },
                    { label: 'Maple Icing' }
                ];

                icingOptions.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-choice icing-option'; // Add specific class
                    button.dataset.optionType = 'icing'; // Identify option type
                    button.dataset.label = option.label;
                    button.innerHTML = `<span>${option.label}</span>`;
                    button.onclick = () => selectIndependentOption(button);
                    icingChoicesDiv.appendChild(button);

                    // Select first icing option by default
                    if (index === 0) {
                        selectIndependentOption(button);
                    }
                });

                // --- FILLING Options ---
                const fillingGroupDiv = document.createElement('div');
                fillingGroupDiv.className = 'options-group';
                fillingGroupDiv.innerHTML = `
                    <label class="options-group-label">Select Filling</label>
                    <span class="options-required">Required*</span>
                    <p class="options-select-prompt">Please select 1</p>
                    <div class="options-choices filling-choices"></div>
                `;
                optionsDetailsDiv.insertBefore(fillingGroupDiv, optionsDetailsDiv.querySelector('.options-footer')); // Insert before footer

                const fillingChoicesDiv = fillingGroupDiv.querySelector('.filling-choices');
                const fillingOptions = [
                    { label: 'BAVARIAN CREAM' },
                    { label: 'RASPBERRY' },
                    { label: 'LEMON' },
                    { label: 'NO FILLING' }
                ];

                fillingOptions.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-choice filling-option'; // Add specific class
                    button.dataset.optionType = 'filling'; // Identify option type
                    button.dataset.label = option.label;
                    button.innerHTML = `<span>${option.label}</span>`;
                    button.onclick = () => selectIndependentOption(button);
                    fillingChoicesDiv.appendChild(button);

                     // Select first filling option by default
                    if (index === 0) {
                        selectIndependentOption(button);
                    }
                });

                 // Hide the original single options group as we now have specific groups
                optionsSelectionGroup.style.display = 'none';
                selectedOptionPriceModifier = item.price; // Price is based on the base item for Eclair
            }
            else {
                // Hide options section if not applicable for other items
                // Ensure specific Eclair groups are hidden if another item is selected
                const optionsDetailsDiv = document.querySelector('.options-details');
                const existingIcingGroup = optionsDetailsDiv.querySelector('.options-group:has(.icing-choices)');
                const existingFillingGroup = optionsDetailsDiv.querySelector('.options-group:has(.filling-choices)');
                if (existingIcingGroup) existingIcingGroup.remove();
                if (existingFillingGroup) existingFillingGroup.remove();

                optionsSelectionGroup.style.display = 'none';
                // For items without options, the price modifier should be the item's own price
                // so that total = item.price * quantity
                selectedOptionPriceModifier = item.price; 
            }
            // --- End Option Generation --- 

            updateOptionsPrice(); // Update price based on default selection
            modal.classList.add('show');
            document.body.classList.add('modal-open');
        }

        // Function to handle selection within independent groups (like Eclair icing/filling)
        function selectIndependentOption(selectedButton) {
            const optionType = selectedButton.dataset.optionType;
            // Deselect others within the same group
            document.querySelectorAll(`.option-choice.${optionType}-option.selected`).forEach(btn => {
                btn.classList.remove('selected');
            });
            // Select the clicked button
            selectedButton.classList.add('selected');
            // Price update is handled by updateOptionsPrice based on base item price for Eclair
            updateOptionsPrice();
        }


        function closeOptionsModal() {
            const modal = document.getElementById('optionsModal');
            modal.classList.remove('show');
            document.body.classList.remove('modal-open');
            currentOptionsItem = null; // Clear current item
        }

        function selectOption(selectedButton, priceModifier) {
            // Deselect previously selected button
            const currentlySelected = document.querySelector('.option-choice.selected');
            if (currentlySelected) {
                currentlySelected.classList.remove('selected');
            }
            // Select the new button
            selectedButton.classList.add('selected');
            selectedOptionPriceModifier = priceModifier;
            updateOptionsPrice();
        }

        function updateOptionsQuantity(change) {
            currentOptionsQuantity += change;
            if (currentOptionsQuantity < 1) {
                currentOptionsQuantity = 1; // Minimum quantity is 1
            }
            document.getElementById('optionsQuantity').textContent = currentOptionsQuantity;
            updateOptionsPrice();
        }

        function updateOptionsPrice() {
            if (!currentOptionsItem) return;
            
            // Price is determined by the selected option's modifier
            // If no options displayed, modifier was set to item.price in showOptionsModal
            // For Eclair, selectedOptionPriceModifier is set to the base item price
            const totalPrice = selectedOptionPriceModifier * currentOptionsQuantity;
            document.getElementById('optionsTotalPrice').textContent = `$${totalPrice.toFixed(2)}`;
        }

        function addOptionsToCart() {
            if (!currentOptionsItem) return;

            const itemNameLower = currentOptionsItem.name.toLowerCase();
            let optionsValid = true;
            let selectedOptions = [];

            // Special handling for Eclair to check both selections
            if (itemNameLower.includes('eclair')) {
                const selectedIcing = document.querySelector('.option-choice.icing-option.selected');
                const selectedFilling = document.querySelector('.option-choice.filling-option.selected');

                if (!selectedIcing) {
                    alert('Please select an icing.');
                    optionsValid = false;
                } else {
                    selectedOptions.push(selectedIcing.dataset.label);
                }

                if (!selectedFilling) {
                    alert('Please select a filling.');
                    optionsValid = false;
                } else {
                    selectedOptions.push(selectedFilling.dataset.label);
                }
            } else {
                // Original logic for other items with single option group
                const optionsGroupVisible = document.getElementById('optionsSelectionGroup').style.display !== 'none';
                const singleOptionSelected = document.querySelector('#optionsChoices .option-choice.selected');
                if (optionsGroupVisible && !singleOptionSelected) {
                    alert('Please select an option.');
                    optionsValid = false;
                } else if (singleOptionSelected) {
                     selectedOptions.push(singleOptionSelected.querySelector('span:first-child').textContent);
                }
            }

            if (!optionsValid) return;


            // --- Check for Pickup Time ---
            if (!document.body.classList.contains('pickup-active')) {
                // Ensure an option is selected if required (before storing)
                if (document.getElementById('optionsSelectionGroup').style.display !== 'none' && !document.querySelector('.option-choice.selected')) {
                    alert('Please select an option.');
                    return;
                }
                
                // Calculate details to store
                let itemNameWithOptions = currentOptionsItem.name;
                const selectedButton = document.querySelector('.option-choice.selected');
                if (selectedButton) {
                    const optionLabel = selectedButton.querySelector('span:first-child').textContent;
                    itemNameWithOptions += ` (${optionLabel})`;
                }
                let basePrice = 0;
                if (document.getElementById('optionsSelectionGroup').style.display === 'none') {
                    basePrice = currentOptionsItem.price;
                }
                const finalPricePerItem = basePrice + selectedOptionPriceModifier;

                // Store details
                itemToAddAfterPickupSelection = {
                    name: itemNameWithOptions,
                    price: finalPricePerItem,
                    quantity: currentOptionsQuantity
                };
                console.log("Pickup time not set. Storing item:", itemToAddAfterPickupSelection);

                // Close current modal and show pickup time modal
                closeOptionsModal();
                showPickupTimeModal(); // Assuming this function exists and opens the pickup modal
                return; // Stop execution here
            }
            // --- End Pickup Time Check ---

            // Continue with original logic if pickup time IS set

            // Determine item name including selected options
            let itemNameWithOptions = currentOptionsItem.name;
            if (selectedOptions.length > 0) {
                 // Join selected options, e.g., "ECLAIR (Chocolate Icing, Bavarian)"
                 itemNameWithOptions += ` (${selectedOptions.join(', ')})`;
            }


            // Calculate final price per item based on selected option
            // For Eclair, price doesn't change with options, use base price
            // For others, use selectedOptionPriceModifier which holds the correct price (single/dozen or base price)
            const finalPricePerItem = selectedOptionPriceModifier;

            // Find existing item in cart (match name with options)
            const existingItemIndex = cart.findIndex(item => item.name === itemNameWithOptions);

            if (existingItemIndex > -1) {
                // Update quantity of existing item
                cart[existingItemIndex].quantity += currentOptionsQuantity;
            } else {
                // Add new item to cart
                cart.push({
                    name: itemNameWithOptions,
                    price: finalPricePerItem, 
                    quantity: currentOptionsQuantity
                });
            }

            updateCartCount();
            updateCartDisplay(); // Optional: Update cart display while modal is open
            closeOptionsModal();

            // Optional: Visual feedback (similar to original addToCart)
            const cartIcon = document.querySelector('.cart-icon');
            cartIcon.classList.add('add-success');
            setTimeout(() => {
                cartIcon.classList.remove('add-success');
            }, 500);
        }


        // --- Existing Functions Continue Below --- 
        // DOMContentLoaded, toggleCart, closeCartOnOutsideClick, addToCart (original simple version), etc.
    </script>
</body>
</html>
